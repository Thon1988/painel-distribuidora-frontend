<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin ‚Äî Ovos Aline</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin:0; padding:0; }
    :root {
      --primary: #E8960C;
      --dark:    #D4500A;
      --brown:   #3D2B1F;
      --cream:   #FFF8EE;
      --muted:   #8B6F5E;
      --white:   #FFFFFF;
      --green:   #2E7D32;
      --red:     #C62828;
      --border:  #E0CFC0;
      --shadow:  0 2px 16px rgba(61,43,31,.10);
    }
    body { font-family:'Segoe UI',system-ui,sans-serif; background:#F5EFE6; color:var(--brown); min-height:100vh; display:flex; flex-direction:column; }
    header { background:linear-gradient(135deg,var(--dark),var(--primary)); color:#fff; padding:0 24px; height:64px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; box-shadow:0 3px 14px rgba(0,0,0,.22); }
    .h-logo { display:flex; align-items:center; gap:10px; font-size:1.15rem; font-weight:900; }
    .h-logo span { font-size:1.5rem; }
    .h-back { background:rgba(255,255,255,.2); border:2px solid rgba(255,255,255,.5); color:#fff; border-radius:50px; padding:6px 16px; cursor:pointer; font-size:.85rem; font-weight:700; text-decoration:none; display:flex; align-items:center; gap:6px; transition:background .2s; }
    .h-back:hover { background:rgba(255,255,255,.35); }
    .layout { display:flex; flex:1; }
    .nav { width:220px; background:var(--white); border-right:1px solid var(--border); padding:20px 0; flex-shrink:0; }
    .nav-title { font-size:.7rem; font-weight:800; color:var(--muted); text-transform:uppercase; letter-spacing:1px; padding:6px 20px 10px; }
    .nav-item { display:flex; align-items:center; gap:10px; padding:11px 20px; cursor:pointer; font-size:.9rem; font-weight:600; color:var(--muted); border-left:3px solid transparent; transition:all .15s; }
    .nav-item:hover  { background:#FFF3E0; color:var(--brown); }
    .nav-item.active { background:#FFF3E0; color:var(--dark); border-left-color:var(--dark); }
    .nav-item .ni { font-size:1.1rem; width:22px; text-align:center; }
    .content { flex:1; padding:28px 24px; overflow-y:auto; max-width:900px; }
    .section { display:none; }
    .section.active { display:block; }
    .page-title { font-size:1.4rem; font-weight:900; margin-bottom:6px; }
    .page-sub   { font-size:.85rem; color:var(--muted); margin-bottom:24px; }
    hr.div { border:none; border-top:1px solid var(--border); margin:24px 0; }
    .card { background:var(--white); border-radius:16px; box-shadow:var(--shadow); padding:24px; margin-bottom:20px; border:1px solid var(--border); }
    .card h3 { font-size:1rem; font-weight:800; margin-bottom:16px; display:flex; align-items:center; gap:8px; }
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .form-grid.full { grid-template-columns:1fr; }
    .field { display:flex; flex-direction:column; gap:5px; }
    .field label { font-size:.78rem; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; }
    .field input, .field select, .field textarea { border:1.5px solid var(--border); border-radius:10px; padding:9px 12px; font-size:.92rem; color:var(--brown); font-family:inherit; transition:border-color .18s,box-shadow .18s; outline:none; background:var(--cream); }
    .field input:focus, .field select:focus, .field textarea:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(232,150,12,.15); }
    .field textarea { resize:vertical; min-height:70px; }
    .color-row { display:flex; align-items:center; gap:10px; }
    .color-row input[type=color] { width:40px; height:36px; padding:2px; border-radius:8px; cursor:pointer; border:1.5px solid var(--border); }
    .btn { border:none; border-radius:50px; padding:10px 22px; font-size:.9rem; font-weight:700; cursor:pointer; transition:opacity .2s,transform .15s; display:inline-flex; align-items:center; gap:6px; }
    .btn:hover { opacity:.85; transform:scale(1.02); }
    .btn-primary { background:linear-gradient(135deg,var(--dark),var(--primary)); color:#fff; }
    .btn-green   { background:linear-gradient(135deg,var(--green),#43A047); color:#fff; }
    .btn-red     { background:var(--red); color:#fff; }
    .btn-ghost   { background:transparent; border:2px solid var(--border); color:var(--muted); }
    .btn-ghost:hover { border-color:var(--primary); color:var(--dark); }
    .btn-sm { padding:6px 14px; font-size:.8rem; }
    .save-row { margin-top:18px; display:flex; gap:10px; align-items:center; }
    .prod-list { display:flex; flex-direction:column; gap:12px; }
    .prod-item { background:var(--white); border:1px solid var(--border); border-radius:14px; padding:14px 18px; display:flex; align-items:center; gap:14px; transition:box-shadow .2s; }
    .prod-item:hover { box-shadow:var(--shadow); }
    .prod-emoji { font-size:2rem; width:44px; text-align:center; flex-shrink:0; }
    .prod-info  { flex:1; }
    .prod-info h4 { font-size:.95rem; font-weight:800; }
    .prod-info p  { font-size:.78rem; color:var(--muted); margin-top:2px; }
    .prod-price   { font-size:1rem; font-weight:900; color:var(--dark); min-width:70px; text-align:right; }
    .prod-actions { display:flex; gap:6px; align-items:center; }
    .toggle-btn { background:none; border:none; cursor:pointer; font-size:1.4rem; padding:2px; line-height:1; }
    .inactive { opacity:.45; }
    .modal-bg { position:fixed; inset:0; background:rgba(0,0,0,.55); z-index:300; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity .3s; }
    .modal-bg.open { opacity:1; pointer-events:all; }
    .modal-box { background:var(--white); border-radius:20px; width:min(520px,100%); max-height:90vh; overflow-y:auto; box-shadow:0 24px 60px rgba(0,0,0,.28); transform:scale(.9); transition:transform .3s; }
    .modal-bg.open .modal-box { transform:scale(1); }
    .modal-head { background:linear-gradient(135deg,var(--dark),var(--primary)); color:#fff; padding:20px 24px; border-radius:20px 20px 0 0; display:flex; justify-content:space-between; align-items:center; }
    .modal-head h3 { font-size:1.1rem; font-weight:800; }
    .modal-close { background:rgba(255,255,255,.2); border:none; color:#fff; width:28px; height:28px; border-radius:50%; cursor:pointer; font-size:.9rem; display:flex; align-items:center; justify-content:center; }
    .modal-body-inner { padding:24px; display:flex; flex-direction:column; gap:14px; }
    .badge-opts { display:flex; gap:8px; flex-wrap:wrap; }
    .badge-opt { padding:4px 12px; border-radius:50px; font-size:.75rem; font-weight:700; cursor:pointer; border:2px solid transparent; transition:all .15s; }
    .badge-opt.sel { border-color:var(--brown); }
    .bo-none  { background:#eee; color:#666; }
    .bo-red   { background:#D4500A; color:#fff; }
    .bo-amber { background:#E8960C; color:#fff; }
    .bo-green { background:#2E7D32; color:#fff; }
    .toast { position:fixed; bottom:22px; left:50%; transform:translateX(-50%) translateY(70px); background:var(--brown); color:#fff; padding:9px 22px; border-radius:50px; font-size:.88rem; font-weight:600; z-index:600; white-space:nowrap; transition:transform .3s; }
    .toast.show { transform:translateX(-50%) translateY(0); }
    .preview-bar { background:linear-gradient(135deg,var(--green),#43A047); color:#fff; padding:12px 24px; display:flex; align-items:center; justify-content:space-between; font-size:.88rem; }
    .preview-bar a { color:#fff; font-weight:700; text-decoration:none; padding:6px 16px; background:rgba(255,255,255,.2); border-radius:50px; transition:background .2s; }
    .preview-bar a:hover { background:rgba(255,255,255,.35); }
    .pix-types { display:flex; flex-wrap:wrap; gap:8px; }
    .pix-type-btn { padding:6px 14px; border-radius:50px; border:2px solid var(--border); background:transparent; color:var(--muted); font-size:.82rem; font-weight:700; cursor:pointer; transition:all .15s; }
    .pix-type-btn.active { border-color:var(--primary); background:var(--primary); color:#fff; }
    @media (max-width:700px) {
      .layout { flex-direction:column; }
      .nav { width:100%; display:flex; flex-direction:row; overflow-x:auto; padding:0; border-right:none; border-bottom:1px solid var(--border); }
      .nav-title { display:none; }
      .nav-item { border-left:none; border-bottom:3px solid transparent; flex-direction:column; gap:2px; font-size:.72rem; padding:10px 14px; white-space:nowrap; }
      .nav-item.active { border-bottom-color:var(--dark); }
      .form-grid { grid-template-columns:1fr; }
      .content { padding:16px 12px; }
    }
  </style>
</head>
<body>

<header>
  <div class="h-logo"><span>‚öôÔ∏è</span> Painel Admin ‚Äî Ovos Aline</div>
  <a href="index.html" class="h-back">üõí Ver Loja</a>
</header>

<div class="preview-bar">
  <span>‚úÖ Altera√ß√µes salvas automaticamente e refletidas na loja em tempo real.</span>
  <a href="index.html" target="_blank">Abrir Loja ‚Üó</a>
</div>

<div class="layout">
  <nav class="nav">
    <div class="nav-title">Menu</div>
    <div class="nav-item active" onclick="goTo('produtos')"><span class="ni">ü•ö</span> Produtos</div>
    <div class="nav-item" onclick="goTo('loja')"><span class="ni">üè™</span> Dados da Loja</div>
    <div class="nav-item" onclick="goTo('pix')"><span class="ni">üíö</span> Configurar PIX</div>
    <div class="nav-item" onclick="goTo('aparencia')"><span class="ni">üé®</span> Apar√™ncia</div>
  </nav>

  <div class="content">

    <div class="section active" id="sec-produtos">
      <div class="page-title">ü•ö Gerenciar Produtos</div>
      <p class="page-sub">Adicione, edite, ative/desative e exclua produtos do cat√°logo.</p>
      <div style="display:flex;justify-content:flex-end;margin-bottom:16px">
        <button class="btn btn-primary" onclick="openProdModal()">+ Adicionar Produto</button>
      </div>
      <div class="prod-list" id="prod-list"></div>
    </div>

    <div class="section" id="sec-loja">
      <div class="page-title">üè™ Dados da Loja</div>
      <p class="page-sub">Edite nome, slogan e textos que aparecem na loja.</p>
      <div class="card">
        <h3>üìù Informa√ß√µes Gerais</h3>
        <div class="form-grid">
          <div class="field"><label>Nome da Loja</label><input type="text" id="cfg-nome" placeholder="Ovos Aline" /></div>
          <div class="field"><label>Emoji / √çcone</label><input type="text" id="cfg-emoji" placeholder="ü•ö" maxlength="4" /></div>
          <div class="field"><label>Slogan (subt√≠tulo)</label><input type="text" id="cfg-slogan" placeholder="Fresquinhos do Campo" /></div>
        </div>
        <hr class="div">
        <h3>ü¶∏ Texto do Banner</h3>
        <div class="form-grid full">
          <div class="field"><label>T√≠tulo do Banner</label><input type="text" id="cfg-heroTitle" placeholder="Ovos Fresquinhos da Aline! ü•ö" /></div>
          <div class="field"><label>Descri√ß√£o do Banner</label><textarea id="cfg-heroDesc" rows="2" placeholder="Do campo direto pra sua mesa..."></textarea></div>
        </div>
        <div class="save-row"><button class="btn btn-green" onclick="saveConfig()">üíæ Salvar Dados da Loja</button></div>
      </div>
    </div>

    <div class="section" id="sec-pix">
      <div class="page-title">üíö Configurar PIX</div>
      <p class="page-sub">Defina sua chave PIX para receber pagamentos na loja.</p>
      <div class="card">
        <h3>üîë Chave PIX</h3>
        <div class="form-grid full">
          <div class="field">
            <label>Tipo de Chave</label>
            <div class="pix-types">
              <button class="pix-type-btn" onclick="setPixType('Telefone','(11) 99999-9999')">üì± Telefone</button>
              <button class="pix-type-btn" onclick="setPixType('CPF','000.000.000-00')">ü™™ CPF</button>
              <button class="pix-type-btn" onclick="setPixType('CNPJ','00.000.000/0001-00')">üè¢ CNPJ</button>
              <button class="pix-type-btn" onclick="setPixType('E-mail','email@exemplo.com')">üìß E-mail</button>
              <button class="pix-type-btn" onclick="setPixType('Chave Aleat√≥ria','cole-sua-chave-aqui')">üîÄ Aleat√≥ria</button>
            </div>
          </div>
          <div class="field"><label>Chave PIX (exatamente como cadastrada no banco)</label><input type="text" id="cfg-pixChave" placeholder="Ex: 11999999999" /></div>
          <div class="field"><label>Nome do Recebedor (como aparece no PIX)</label><input type="text" id="cfg-pixNome" placeholder="Aline Ovos Frescos" maxlength="25" /></div>
          <div class="field"><label>Cidade (para o QR Code, sem acentos)</label><input type="text" id="cfg-pixCidade" placeholder="SAO PAULO" maxlength="15" /></div>
        </div>
        <hr class="div">
        <h3>üëÅ Pr√©via do QR Code</h3>
        <div style="display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;margin-top:8px">
          <div id="pix-preview-qr" style="background:#fff;padding:12px;border-radius:12px;border:3px solid var(--primary)"></div>
          <div style="flex:1;min-width:200px">
            <p style="font-size:.85rem;color:var(--muted);margin-bottom:8px">Esta pr√©via usa R$1,00 de teste. O QR Code real ser√° gerado com o valor do pedido do cliente.</p>
            <button class="btn btn-ghost btn-sm" onclick="renderPixPreview()">üîÑ Atualizar Pr√©via</button>
          </div>
        </div>
        <div class="save-row"><button class="btn btn-green" onclick="saveConfig()">üíæ Salvar PIX</button></div>
      </div>
    </div>

    <div class="section" id="sec-aparencia">
      <div class="page-title">üé® Apar√™ncia da Loja</div>
      <p class="page-sub">Personalize as cores do tema da sua loja.</p>
      <div class="card">
        <h3>üé® Cores do Tema</h3>
        <div class="form-grid">
          <div class="field">
            <label>Cor Principal (bot√µes e destaques)</label>
            <div class="color-row">
              <input type="color" id="cfg-corPrimaria" value="#E8960C" oninput="updateColorPreview()" />
              <input type="text" id="cfg-corPrimariaHex" value="#E8960C" placeholder="#E8960C" oninput="syncColorFromText('Primaria')" style="flex:1" />
            </div>
          </div>
          <div class="field">
            <label>Cor Secund√°ria (header e cards)</label>
            <div class="color-row">
              <input type="color" id="cfg-corSecundaria" value="#D4500A" oninput="updateColorPreview()" />
              <input type="text" id="cfg-corSecundariaHex" value="#D4500A" placeholder="#D4500A" oninput="syncColorFromText('Secundaria')" style="flex:1" />
            </div>
          </div>
        </div>
        <div style="margin-top:16px;padding:16px;background:var(--cream);border-radius:12px;border:1px solid var(--border)">
          <p style="font-size:.8rem;font-weight:700;margin-bottom:10px">Temas pr√©-definidos:</p>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-sm" style="background:linear-gradient(135deg,#D4500A,#E8960C);color:#fff" onclick="setTheme('#E8960C','#D4500A')">ü•ö Original</button>
            <button class="btn btn-sm" style="background:linear-gradient(135deg,#2E7D32,#43A047);color:#fff" onclick="setTheme('#43A047','#2E7D32')">üåø Verde Campo</button>
            <button class="btn btn-sm" style="background:linear-gradient(135deg,#1565C0,#1976D2);color:#fff" onclick="setTheme('#1976D2','#1565C0')">üíô Azul Mar</button>
            <button class="btn btn-sm" style="background:linear-gradient(135deg,#6A1B9A,#8E24AA);color:#fff" onclick="setTheme('#8E24AA','#6A1B9A')">üíú Roxo Real</button>
            <button class="btn btn-sm" style="background:linear-gradient(135deg,#B71C1C,#E53935);color:#fff" onclick="setTheme('#E53935','#B71C1C')">‚ù§Ô∏è Vermelho</button>
          </div>
        </div>
        <div class="save-row"><button class="btn btn-green" onclick="saveConfig()">üíæ Salvar Apar√™ncia</button></div>
      </div>
    </div>

  </div>
</div>

<div class="modal-bg" id="prod-modal">
  <div class="modal-box">
    <div class="modal-head">
      <h3 id="modal-prod-title">Novo Produto</h3>
      <button class="modal-close" onclick="closeProdModal()">‚úï</button>
    </div>
    <div class="modal-body-inner">
      <input type="hidden" id="mp-id" />
      <div class="form-grid">
        <div class="field"><label>Nome do Produto</label><input id="mp-nome" placeholder="Ex: Ovos Grandes" /></div>
        <div class="field"><label>Emoji</label><input id="mp-emoji" placeholder="ü•ö" maxlength="4" /></div>
        <div class="field"><label>Tipo / Subt√≠tulo</label><input id="mp-tipo" placeholder="Ex: Tamanho G ‚Äî D√∫zia" /></div>
        <div class="field"><label>Pre√ßo (R$)</label><input id="mp-preco" type="number" min="0" step="0.01" placeholder="12.90" /></div>
      </div>
      <div class="field"><label>Descri√ß√£o</label><textarea id="mp-desc" rows="3" placeholder="Descreva o produto..."></textarea></div>
      <div class="field">
        <label>Etiqueta (Badge)</label>
        <div class="badge-opts">
          <div class="badge-opt bo-none sel" data-badge="" data-class="" onclick="selBadge(this,'','')">Nenhuma</div>
          <div class="badge-opt bo-red"   data-badge="Popular"   data-class=""      onclick="selBadge(this,'Popular','')">Popular</div>
          <div class="badge-opt bo-red"   data-badge="Top Venda" data-class=""      onclick="selBadge(this,'Top Venda','')">Top Venda</div>
          <div class="badge-opt bo-amber" data-badge="Especial"  data-class="amber" onclick="selBadge(this,'Especial','amber')">Especial</div>
          <div class="badge-opt bo-green" data-badge="Premium"   data-class="green" onclick="selBadge(this,'Premium','green')">Premium</div>
          <div class="badge-opt bo-red"   data-badge="Novo"      data-class=""      onclick="selBadge(this,'Novo','')">Novo</div>
          <div class="badge-opt bo-amber" data-badge="Promo√ß√£o"  data-class="amber" onclick="selBadge(this,'Promo√ß√£o','amber')">Promo√ß√£o</div>
        </div>
        <input type="hidden" id="mp-badge" />
        <input type="hidden" id="mp-badgeClass" />
      </div>
      <div style="display:flex;gap:10px;margin-top:6px">
        <button class="btn btn-green" style="flex:1" onclick="saveProd()">üíæ Salvar Produto</button>
        <button class="btn btn-ghost" onclick="closeProdModal()">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const DEFAULT_CONFIG = {
  nome:'Ovos Aline', slogan:'Fresquinhos do Campo', emoji:'ü•ö',
  heroTitle:'Ovos <em>Fresquinhos</em><br>da Aline! ü•ö',
  heroDesc:'Do campo direto pra sua mesa. Qualidade garantida, selecionados um a um com carinho.',
  pixChave:'11999999999', pixTipo:'Telefone',
  pixNome:'Aline Ovos Frescos', pixCidade:'SAO PAULO',
  corPrimaria:'#E8960C', corSecundaria:'#D4500A'
};

const DEFAULT_PRODUTOS = [
  { id:1, emoji:'ü•ö', nome:'Ovos Brancos Pequenos',    tipo:'Tamanho P ‚Äî D√∫zia', badge:'',         badgeClass:'',     desc:'Ovos brancos selecionados, tamanho pequeno. Perfeitos para caf√© da manh√£ e fritadas r√°pidas.', preco:8.90,  ativo:true },
  { id:2, emoji:'ü•ö', nome:'Ovos Brancos M√©dios',      tipo:'Tamanho M ‚Äî D√∫zia', badge:'',         badgeClass:'',     desc:'O favorito do dia a dia! Tamanho ideal para qualquer receita, da omelete ao bolo.',            preco:10.90, ativo:true },
  { id:3, emoji:'ü•ö', nome:'Ovos Brancos Grandes',     tipo:'Tamanho G ‚Äî D√∫zia', badge:'Popular',  badgeClass:'',     desc:'Ovos maiores com gema mais volumosa. √ìtimos para massas, tortas e confeitaria.',               preco:12.90, ativo:true },
  { id:4, emoji:'ü•ö', nome:'Ovos Extra Grandes',       tipo:'Tamanho XG ‚Äî D√∫zia',badge:'Top Venda',badgeClass:'',     desc:'Os maiores! Gema rica e intensa. Escolha dos chefs para bolos especiais e cremes.',             preco:14.90, ativo:true },
  { id:5, emoji:'üêì', nome:'Ovos Caipira',             tipo:'Caipira ‚Äî D√∫zia',   badge:'Especial', badgeClass:'amber',desc:'Cria√ß√£o livre no campo. Gema laranjinha e sabor incompar√°vel. Direto da ro√ßa!',              preco:18.90, ativo:true },
  { id:6, emoji:'üåø', nome:'Ovos Org√¢nicos',           tipo:'Org√¢nico ‚Äî D√∫zia',  badge:'Premium',  badgeClass:'green',desc:'100% org√¢nicos, sem antibi√≥ticos. Saud√°vel e sustent√°vel. Certificado.',                     preco:24.90, ativo:true },
];

function getConfig()   { try { return JSON.parse(localStorage.getItem('oa_config'))  || DEFAULT_CONFIG;   } catch(e) { return DEFAULT_CONFIG; } }
function getProdutos() { try { return JSON.parse(localStorage.getItem('oa_produtos')) || DEFAULT_PRODUTOS; } catch(e) { return DEFAULT_PRODUTOS; } }
function saveLS(key, val) { localStorage.setItem(key, JSON.stringify(val)); }

let config   = getConfig();
let produtos = getProdutos();

function goTo(sec) {
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('sec-' + sec).classList.add('active');
  if (sec === 'loja')      loadLojaForm();
  if (sec === 'pix')       { loadPixForm(); renderPixPreview(); }
  if (sec === 'aparencia') loadAparenciaForm();
}

function renderProdList() {
  const list = document.getElementById('prod-list');
  if (!produtos.length) { list.innerHTML = '<p style="color:var(--muted);text-align:center;padding:30px">Nenhum produto cadastrado.</p>'; return; }
  list.innerHTML = produtos.map(p => `
    <div class="prod-item ${p.ativo?'':'inactive'}">
      <div class="prod-emoji">${p.emoji}</div>
      <div class="prod-info">
        <h4>${p.nome} ${p.badge?`<span style="background:${p.badgeClass==='green'?'#2E7D32':p.badgeClass==='amber'?'#E8960C':'#D4500A'};color:#fff;font-size:.65rem;padding:2px 8px;border-radius:50px;font-weight:800;vertical-align:middle">${p.badge}</span>`:''}</h4>
        <p>${p.tipo} ¬∑ ${p.ativo?'‚úÖ Ativo':'‚è∏ Inativo'}</p>
      </div>
      <div class="prod-price">R$ ${fmt(p.preco)}</div>
      <div class="prod-actions">
        <button class="toggle-btn" onclick="toggleProd(${p.id})">${p.ativo?'üü¢':'‚ö´'}</button>
        <button class="btn btn-ghost btn-sm" onclick="editProd(${p.id})">‚úèÔ∏è Editar</button>
        <button class="btn btn-red btn-sm" onclick="deleteProd(${p.id})">üóë</button>
      </div>
    </div>`).join('');
}

function toggleProd(id) {
  const p = produtos.find(x=>x.id==id);
  if (p) { p.ativo = !p.ativo; saveLS('oa_produtos', produtos); renderProdList(); toast(p.ativo?'‚úÖ Produto ativado!':'‚è∏ Produto desativado'); }
}

function deleteProd(id) {
  if (!confirm('Excluir este produto?')) return;
  produtos = produtos.filter(p=>p.id!=id);
  saveLS('oa_produtos', produtos);
  renderProdList();
  toast('üóë Produto exclu√≠do!');
}

let editingId = null;

function openProdModal(id=null) {
  editingId = id;
  document.getElementById('modal-prod-title').textContent = id ? 'Editar Produto' : 'Novo Produto';
  const p = id ? produtos.find(x=>x.id==id) : {};
  document.getElementById('mp-id').value         = id || '';
  document.getElementById('mp-nome').value        = p.nome  || '';
  document.getElementById('mp-emoji').value       = p.emoji || 'ü•ö';
  document.getElementById('mp-tipo').value        = p.tipo  || '';
  document.getElementById('mp-preco').value       = p.preco || '';
  document.getElementById('mp-desc').value        = p.desc  || '';
  document.getElementById('mp-badge').value       = p.badge || '';
  document.getElementById('mp-badgeClass').value  = p.badgeClass || '';
  document.querySelectorAll('.badge-opt').forEach(el => {
    el.classList.remove('sel');
    if (el.dataset.badge === (p.badge||'')) el.classList.add('sel');
  });
  document.getElementById('prod-modal').classList.add('open');
}

function closeProdModal() { document.getElementById('prod-modal').classList.remove('open'); }

function selBadge(el, badge, cls) {
  document.querySelectorAll('.badge-opt').forEach(x=>x.classList.remove('sel'));
  el.classList.add('sel');
  document.getElementById('mp-badge').value      = badge;
  document.getElementById('mp-badgeClass').value = cls;
}

function saveProd() {
  const nome  = document.getElementById('mp-nome').value.trim();
  const preco = parseFloat(document.getElementById('mp-preco').value);
  if (!nome)        { toast('‚ö†Ô∏è Informe o nome!'); return; }
  if (isNaN(preco)) { toast('‚ö†Ô∏è Informe o pre√ßo!'); return; }
  const data = {
    nome, emoji: document.getElementById('mp-emoji').value || 'ü•ö',
    tipo: document.getElementById('mp-tipo').value, preco,
    desc: document.getElementById('mp-desc').value,
    badge: document.getElementById('mp-badge').value,
    badgeClass: document.getElementById('mp-badgeClass').value,
    ativo: true,
  };
  if (editingId) {
    const idx = produtos.findIndex(p=>p.id==editingId);
    if (idx>-1) produtos[idx] = { ...produtos[idx], ...data };
  } else {
    const maxId = produtos.reduce((m,p)=>Math.max(m,p.id),0);
    produtos.push({ id: maxId+1, ...data });
  }
  saveLS('oa_produtos', produtos);
  renderProdList();
  closeProdModal();
  toast('‚úÖ Produto salvo!');
}

function editProd(id) { openProdModal(id); }

function loadLojaForm() {
  document.getElementById('cfg-nome').value      = config.nome      || '';
  document.getElementById('cfg-emoji').value     = config.emoji     || 'ü•ö';
  document.getElementById('cfg-slogan').value    = config.slogan    || '';
  document.getElementById('cfg-heroTitle').value = (config.heroTitle||'').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();
  document.getElementById('cfg-heroDesc').value  = config.heroDesc  || '';
}

function loadPixForm() {
  document.getElementById('cfg-pixChave').value  = config.pixChave  || '';
  document.getElementById('cfg-pixNome').value   = config.pixNome   || '';
  document.getElementById('cfg-pixCidade').value = config.pixCidade || '';
  document.querySelectorAll('.pix-type-btn').forEach(b => {
    b.classList.toggle('active', b.textContent.includes(config.pixTipo||'Telefone'));
  });
}

function setPixType(tipo, placeholder) {
  config.pixTipo = tipo;
  document.querySelectorAll('.pix-type-btn').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('cfg-pixChave').placeholder = placeholder;
}

function renderPixPreview() {
  const chave  = document.getElementById('cfg-pixChave').value  || config.pixChave  || '11999999999';
  const nome   = document.getElementById('cfg-pixNome').value   || config.pixNome   || 'OVOSALINE';
  const cidade = document.getElementById('cfg-pixCidade').value || config.pixCidade || 'BRASIL';
  const p      = pixPayload(chave, 1.00, nome, cidade, 'PREVIEW001');
  const div    = document.getElementById('pix-preview-qr');
  div.innerHTML = '';
  try {
    new QRCode(div, { text:p, width:150, height:150, colorDark:'#1B5E20', colorLight:'#FFFFFF', correctLevel:QRCode.CorrectLevel.M });
  } catch(e) { div.innerHTML = '<p style="font-size:.75rem;color:var(--muted)">Carregando QRCode...</p>'; }
}

function loadAparenciaForm() {
  const p = config.corPrimaria   || '#E8960C';
  const s = config.corSecundaria || '#D4500A';
  document.getElementById('cfg-corPrimaria').value     = p;
  document.getElementById('cfg-corPrimariaHex').value  = p;
  document.getElementById('cfg-corSecundaria').value    = s;
  document.getElementById('cfg-corSecundariaHex').value = s;
}

function updateColorPreview() {
  document.getElementById('cfg-corPrimariaHex').value   = document.getElementById('cfg-corPrimaria').value;
  document.getElementById('cfg-corSecundariaHex').value = document.getElementById('cfg-corSecundaria').value;
}

function syncColorFromText(which) {
  const hex = document.getElementById('cfg-cor'+which+'Hex').value;
  if (/^#[0-9A-Fa-f]{6}$/.test(hex))
    document.getElementById('cfg-cor'+which).value = hex;
}

function setTheme(primary, secondary) {
  config.corPrimaria   = primary;
  config.corSecundaria = secondary;
  saveLS('oa_config', config);
  loadAparenciaForm();
  toast('üé® Tema aplicado e salvo!');
}

function saveConfig() {
  if (document.getElementById('cfg-nome')) {
    config.nome   = document.getElementById('cfg-nome').value   || config.nome;
    config.slogan = document.getElementById('cfg-slogan').value || config.slogan;
    config.emoji  = document.getElementById('cfg-emoji').value  || config.emoji;
    const ht = document.getElementById('cfg-heroTitle').value;
    if (ht) config.heroTitle = ht;
    const hd = document.getElementById('cfg-heroDesc').value;
    if (hd) config.heroDesc = hd;
  }
  if (document.getElementById('cfg-pixChave')) {
    config.pixChave  = document.getElementById('cfg-pixChave').value  || config.pixChave;
    config.pixNome   = document.getElementById('cfg-pixNome').value   || config.pixNome;
    config.pixCidade = document.getElementById('cfg-pixCidade').value || config.pixCidade;
  }
  if (document.getElementById('cfg-corPrimaria')) {
    config.corPrimaria   = document.getElementById('cfg-corPrimaria').value;
    config.corSecundaria = document.getElementById('cfg-corSecundaria').value;
  }
  saveLS('oa_config', config);
  toast('‚úÖ Salvo com sucesso!');
}

// ‚îÄ‚îÄ PIX PAYLOAD BR CODE (corrigido) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function removeAccents(s) {
  return (s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^\x00-\x7F]/g,'').toUpperCase();
}
function pixPayload(key, amount, name, city, txid) {
  const tlv = (id, v) => id + String(v.length).padStart(2,'0') + v;
  const ma = tlv('00','BR.GOV.BCB.PIX') + tlv('01', key);
  const txidClean = removeAccents(txid).replace(/[^A-Za-z0-9]/g,'').slice(0,25) || 'PREVIEW';
  const adf = tlv('05', txidClean);
  const safeName = removeAccents(name).slice(0,25) || 'OVOSALINE';
  const safeCity = removeAccents(city).slice(0,15) || 'BRASIL';
  let p = tlv('00','01')
        + tlv('26', ma)
        + tlv('52','0000')
        + tlv('53','986');
  if (amount > 0) p += tlv('54', amount.toFixed(2));
  p += tlv('58','BR')
     + tlv('59', safeName)
     + tlv('60', safeCity)
     + tlv('62', adf);
  return p + tlv('63', crc16(p + '6304'));
}
function crc16(s) {
  let c = 0xFFFF;
  for (let i = 0; i < s.length; i++) {
    c ^= (s.charCodeAt(i) & 0xFF) << 8;
    for (let j = 0; j < 8; j++)
      c = (c & 0x8000) ? ((c << 1) ^ 0x1021) & 0xFFFF : (c << 1) & 0xFFFF;
  }
  return (c & 0xFFFF).toString(16).toUpperCase().padStart(4,'0');
}

function toast(msg) {
  const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}
const fmt = n => Number(n).toFixed(2).replace('.',',');

renderProdList();

const qrScript = document.createElement('script');
qrScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js';
document.head.appendChild(qrScript);
</script>
</body>
</html>
