<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppEgg - Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #ffce00; --dark: #333; --bg: #f4f4f4; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #222; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; }
        
        /* Container Formato Celular */
        .phone-container { 
            width: 100%; max-width: 400px; background: var(--bg); height: 850px; 
            border-radius: 30px; position: relative; overflow: hidden; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.5); border: 8px solid #444;
        }

        header { background: var(--primary); padding: 20px; text-align: center; font-weight: bold; font-size: 1.2rem; color: var(--dark); }
        
        .content { padding: 15px; height: calc(100% - 130px); overflow-y: auto; }
        
        /* Tabs */
        .tabs { display: flex; background: #ddd; }
        .tab-btn { flex: 1; padding: 12px; border: none; cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: var(--dark); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards e Listas */
        .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        
        .badge { background: #eee; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; }
        .btn-history { background: var(--dark); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.7rem; }
        
        /* Formulários */
        input, select { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ccc; border-radius: 5px; }
        .btn-main { background: var(--dark); color: white; width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }

        footer { position: absolute; bottom: 0; width: 100%; background: white; padding: 15px; text-align: center; border-top: 1px solid #ddd; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>

<div class="phone-container">
    <header>AppEgg Admin</header>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('estoque')">Estoque</button>
        <button class="tab-btn" onclick="openTab('clientes')">Clientes</button>
        <button class="tab-btn" onclick="openTab('relatorios')">Relatórios</button>
    </div>

    <div class="content">
        <div id="estoque" class="tab-content active">
            <div class="card">
                <input type="text" id="prodNome" placeholder="Nome do Produto">
                <input type="number" id="prodPreco" placeholder="Preço (R$)">
                <button class="btn-main" onclick="adicionarProduto()">Cadastrar Produto</button>
            </div>
            <div id="listaEstoque"></div>
        </div>

        <div id="clientes" class="tab-content">
            <div id="listaClientes"></div>
        </div>

        <div id="relatorios" class="tab-content">
            <div class="card">
                <select id="filtroRelatorio" onchange="renderizarRelatorios()">
                    <option value="dia">Hoje</option>
                    <option value="semana">Esta Semana</option>
                    <option value="mes">Este Mês</option>
                </select>
                <h2 id="totalVendas" style="text-align: center; color: green;">R$ 0,00</h2>
                <p style="text-align: center; font-size: 0.8rem;">Total em Vendas</p>
            </div>
            <div id="historicoGeral"></div>
        </div>
    </div>

    <footer>Status: Conectado ao AppEgg Local</footer>
</div>

<script>
    // Inicialização do Banco de Dados Local
    if(!localStorage.getItem('egg_produtos')) localStorage.setItem('egg_produtos', JSON.stringify([]));
    if(!localStorage.getItem('egg_pedidos')) localStorage.setItem('egg_pedidos', JSON.stringify([]));

    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'estoque') renderizarEstoque();
        if(tabId === 'clientes') renderizarClientes();
        if(tabId === 'relatorios') renderizarRelatorios();
    }

    // --- FUNÇÕES DE ESTOQUE ---
    function adicionarProduto() {
        const nome = document.getElementById('prodNome').value;
        const preco = document.getElementById('prodPreco').value;
        if(!nome || !preco) return alert("Preencha tudo!");

        const produtos = JSON.parse(localStorage.getItem('egg_produtos'));
        produtos.push({ id: Date.now(), nome, preco: parseFloat(preco) });
        localStorage.setItem('egg_produtos', JSON.stringify(produtos));
        
        document.getElementById('prodNome').value = '';
        document.getElementById('prodPreco').value = '';
        renderizarEstoque();
    }

    function renderizarEstoque() {
        const produtos = JSON.parse(localStorage.getItem('egg_produtos'));
        const container = document.getElementById('listaEstoque');
        container.innerHTML = '<h4>Itens no Catálogo</h4>';
        produtos.forEach(p => {
            container.innerHTML += `
                <div class="item-row card">
                    <span>${p.nome}</span>
                    <div>
                        <b>R$ ${p.preco.toFixed(2)}</b>
                        <button onclick="removerProduto(${p.id})" style="color:red; margin-left:10px; border:none; background:none; cursor:pointer">X</button>
                    </div>
                </div>`;
        });
    }

    function removerProduto(id) {
        let produtos = JSON.parse(localStorage.getItem('egg_produtos'));
        produtos = produtos.filter(p => p.id !== id);
        localStorage.setItem('egg_produtos', JSON.stringify(produtos));
        renderizarEstoque();
    }

    // --- FUNÇÕES DE CLIENTES ---
    function renderizarClientes() {
        const pedidos = JSON.parse(localStorage.getItem('egg_pedidos'));
        const container = document.getElementById('listaClientes');
        container.innerHTML = '<h4>Clientes Recentes</h4>';
        
        // Pega nomes únicos de quem já pediu
        const clientesUnicos = [...new Set(pedidos.map(p => p.cliente))];
        
        if(clientesUnicos.length === 0) container.innerHTML += "<p>Nenhum cliente cadastrado.</p>";

        clientesUnicos.forEach(c => {
            container.innerHTML += `
                <div class="item-row card">
                    <span><i class="fa fa-user"></i> ${c}</span>
                    <button class="btn-history" onclick="verHistorico('${c}')">Ver Pedidos</button>
                </div>`;
        });
    }

    function verHistorico(nome) {
        const pedidos = JSON.parse(localStorage.getItem('egg_pedidos')).filter(p => p.cliente === nome);
        let msg = `Histórico de ${nome}:\n\n`;
        pedidos.forEach(p => msg += `${p.data} - ${p.item} (R$ ${p.total.toFixed(2)})\n`);
        alert(msg);
    }

    // --- RELATÓRIOS ---
    function renderizarRelatorios() {
        const filtro = document.getElementById('filtroRelatorio').value;
        const pedidos = JSON.parse(localStorage.getItem('egg_pedidos'));
        let total = 0;
        
        // Lógica simplificada de filtro por data
        pedidos.forEach(p => total += p.total);
        
        document.getElementById('totalVendas').innerText = `R$ ${total.toFixed(2)}`;
        const histCont = document.getElementById('historicoGeral');
        histCont.innerHTML = '<h4>Últimas Atividades</h4>';
        pedidos.reverse().slice(0, 10).forEach(p => {
            histCont.innerHTML += `<div style="font-size:0.8rem; margin-bottom:5px;">${p.data} - ${p.cliente} comprou ${p.item}</div>`;
        });
    }

    renderizarEstoque();
</script>
</body>
</html>