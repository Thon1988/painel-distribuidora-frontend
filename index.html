<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AppEgg Admin | Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
body{font-family:Inter,sans-serif;background:#f4f7f6;color:#1f2937}
.nav-link{font-size:13px;font-weight:800;text-transform:uppercase;color:#6b7280;padding:14px 24px;border-radius:16px}
.nav-link.active{color:#e11d48;background:#fff}
.logo-text{font-weight:900;color:#e11d48;font-size:1.6rem}
.card{background:#fff;border-radius:32px;box-shadow:0 10px 40px rgba(0,0,0,.03)}
</style>
</head>
<body>
<div id="app-root"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

const firebaseConfig={
apiKey:"AIzaSyD3Otz9-zdZH-E5Feg9IOGWPzVycoe8gro",
authDomain:"distribuidora-de-ovos-aline.firebaseapp.com",
projectId:"distribuidora-de-ovos-aline",
storageBucket:"distribuidora-de-ovos-aline.firebasestorage.app",
messagingSenderId:"92187548716",
appId:"1:92187548716:web:d61d18a29aa76aead7c589"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

window.state={user:null,view:'pedidos',logs:[]};

onAuthStateChanged(auth,u=>{
state.user=u;
if(u)sync();
render();
});

function sync(){
onSnapshot(query(collection(db,"vendas_logs"),orderBy("criadoEm","desc")),s=>{
state.logs=s.docs.map(d=>({id:d.id,...d.data()}));
render();
});
}

function render(){
const r=document.getElementById("app-root");
if(!state.user){r.innerHTML=login();return;}
r.innerHTML=`
<nav class="bg-white h-24 flex justify-between items-center px-8">
<div class="logo-text">AppEgg</div>
<div class="flex gap-2">
<button onclick="signOut(auth)" class="nav-link">Sair</button>
</div>
</nav>
<main class="p-8 max-w-5xl mx-auto">
${renderPedidos()}
</main>`;
}

function renderPedidos(){
const ativos=state.logs.filter(l=>!['FINALIZADO','CANCELADO'].includes(l.status));
if(!ativos.length)return `<div class="card p-20 text-center font-black text-gray-300 uppercase">Nenhum pedido</div>`;
return ativos.map(l=>`
<div class="card p-8 mb-6">
<div class="flex justify-between mb-4">
<div>
<h3 class="font-black uppercase">${l.clienteNome}</h3>
<p class="text-xs text-gray-400">${l.produto} â€¢ ${l.quantidade} un</p>
</div>
<span class="px-4 py-2 rounded-xl bg-gray-100 text-xs font-black">${l.status}</span>
</div>
<div class="flex gap-3">
${renderAcoes(l)}
</div>
</div>
`).join('');
}

function renderAcoes(l){
if(l.status==='CRIADO')return `<button onclick="setStatus('${l.id}','EMBALANDO')" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-black uppercase text-xs">Embalando</button>`;
if(l.status==='EMBALANDO'){
return `
<button onclick="setStatus('${l.id}','SAIU_PARA_ENTREGA')" class="flex-1 bg-emerald-600 text-white py-4 rounded-2xl font-black uppercase text-xs">Saiu p/ Entrega</button>
<button onclick="setStatus('${l.id}','AGUARDANDO_RETIRADA')" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase text-xs">Pronto p/ Retirada</button>`;
}
if(l.status==='SAIU_PARA_ENTREGA'||l.status==='AGUARDANDO_RETIRADA'){
return `<button onclick="setStatus('${l.id}','FINALIZADO')" class="flex-1 bg-gray-900 text-white py-4 rounded-2xl font-black uppercase text-xs">Finalizar</button>`;
}
return '';
}

window.setStatus=async(id,status)=>{
await updateDoc(doc(db,"vendas_logs",id),{status});
};

function login(){
return `
<div class="min-h-screen flex items-center justify-center bg-gray-900 p-8">
<form onsubmit="handleLogin(event)" class="bg-white p-12 rounded-[48px] w-full max-w-md">
<div class="logo-text text-5xl mb-6 text-center">AppEgg</div>
<input name="email" class="w-full p-4 mb-3 rounded-xl border" placeholder="Email">
<input name="pass" type="password" class="w-full p-4 mb-6 rounded-xl border" placeholder="Senha">
<button class="w-full bg-rose-600 text-white py-4 rounded-2xl font-black uppercase">Entrar</button>
</form>
</div>`;
}

window.handleLogin=async(e)=>{
e.preventDefault();
const f=new FormData(e.target);
await signInWithEmailAndPassword(auth,f.get("email"),f.get("pass"));
};

window.signOut=()=>signOut(auth);
</script>
</body>
</html>
