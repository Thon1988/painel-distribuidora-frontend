<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AppEgg Admin | Dashboard Pro</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
body { font-family:'Inter',sans-serif;background:#f4f7f6;color:#1f2937 }
.nav-link{font-size:13px;font-weight:800;text-transform:uppercase;color:#6b7280;padding:14px 24px;border-radius:16px}
.nav-link.active{color:#e11d48;background:#fff;border:2px solid #ffe4e6}
.logo-text{font-weight:900;color:#e11d48;font-size:1.6rem}
.card{background:#fff;border-radius:32px;padding:32px;box-shadow:0 10px 40px rgba(0,0,0,.03)}
.input-egg{width:100%;padding:16px;background:#f9fafb;border-radius:20px;font-weight:700}
</style>
</head>

<body>
<div id="app-root"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

const firebaseConfig={
 apiKey:"AIzaSyD3Otz9-zdZH-E5Feg9IOGWPzVycoe8gro",
 authDomain:"distribuidora-de-ovos-aline.firebaseapp.com",
 projectId:"distribuidora-de-ovos-aline"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

const state={
 user:null,
 view:'dashboard',
 pedidos:[]
};

onAuthStateChanged(auth,u=>{
 state.user=u;
 if(u) syncPedidos();
 render();
});

function syncPedidos(){
 const q=query(collection(db,"vendas_logs"),orderBy("criadoEm","desc"));
 onSnapshot(q,s=>{
  state.pedidos=s.docs.map(d=>({id:d.id,...d.data()}));
  render();
 });
}

window.render=()=>{
 const r=document.getElementById("app-root");
 if(!state.user){ r.innerHTML=login(); return; }

 r.innerHTML=`
 <nav class="bg-white h-24 px-8 flex justify-between items-center">
  <div class="logo-text">AppEgg</div>
  <div class="flex gap-2">
   <button class="nav-link ${state.view==='pedidos'?'active':''}" onclick="state.view='pedidos';render()">Pedidos</button>
   <button class="nav-link ${state.view==='dashboard'?'active':''}" onclick="state.view='dashboard';render()">Dashboard</button>
   <button class="nav-link text-rose-600" onclick="signOut(auth)">Sair</button>
  </div>
 </nav>

 <main class="p-8 max-w-6xl mx-auto">
 ${state.view==='pedidos'?renderPedidos():renderDashboard()}
 </main>`;
};

function renderDashboard(){
 return `
 <div class="card">
  <h1 class="text-3xl font-black">Bem-vindo ao AppEgg</h1>
  <p class="text-gray-400">Painel administrativo completo</p>
 </div>`;
}

function renderPedidos(){
 return state.pedidos.map(p=>`
 <div class="card mb-6 border-l-8 ${p.status==='FINALIZADO'?'border-emerald-500':'border-rose-500'}">
  <div class="flex justify-between mb-4">
   <div>
    <h3 class="font-black">${p.clienteNome}</h3>
    <p class="text-xs text-gray-400">${p.produto}</p>
   </div>
   <span class="text-xs font-black">${p.status}</span>
  </div>

  <div class="flex gap-2 flex-wrap">
   <button onclick="setStatus('${p.id}','CRIADO')" class="px-4 py-2 bg-gray-100 rounded-xl font-black text-xs">Criado</button>
   <button onclick="setStatus('${p.id}','EMBALANDO')" class="px-4 py-2 bg-yellow-100 rounded-xl font-black text-xs">Embalando</button>
   <button onclick="setStatus('${p.id}','SAIU PARA ENTREGA')" class="px-4 py-2 bg-blue-100 rounded-xl font-black text-xs">Entrega</button>
   <button onclick="setStatus('${p.id}','AGUARDANDO RETIRADA')" class="px-4 py-2 bg-purple-100 rounded-xl font-black text-xs">Retirada</button>
   <button onclick="setStatus('${p.id}','FINALIZADO')" class="px-4 py-2 bg-emerald-600 text-white rounded-xl font-black text-xs">Finalizar</button>
  </div>
 </div>
`).join('') || '<div class="text-center text-gray-400">Sem pedidos</div>';
}

window.setStatus=async(id,status)=>{
 await updateDoc(doc(db,"vendas_logs",id),{
  status,
  atualizadoEm:serverTimestamp()
 });
};

function login(){
 return `
 <div class="min-h-screen flex items-center justify-center">
  <form onsubmit="loginSubmit(event)" class="card max-w-md w-full">
   <div class="logo-text text-4xl text-center mb-6">AppEgg</div>
   <input name="email" class="input-egg mb-3" placeholder="Email">
   <input name="pass" type="password" class="input-egg mb-6" placeholder="Senha">
   <button class="w-full bg-rose-600 text-white py-4 rounded-2xl font-black">Entrar</button>
  </form>
 </div>`;
}

window.loginSubmit=async e=>{
 e.preventDefault();
 const f=new FormData(e.target);
 await signInWithEmailAndPassword(auth,f.get("email"),f.get("pass"));
};
</script>
</body>
</html>
