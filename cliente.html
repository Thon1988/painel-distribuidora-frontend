<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">App Ovos Aline</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
    
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #e11d48;
      --dark:    #be123c;
      --cream:   #f8fafc;
      --brown:   #0f172a;
      --muted:   #64748b;
      --white:   #ffffff;
      --green:   #10b981;
      --shadow:  0 10px 30px rgba(15, 23, 42, 0.08);
    }
    body { font-family:'Inter', system-ui, sans-serif; background:var(--cream); color:var(--brown); min-height:100vh; }

    /* HEADER */
    header {
      background: var(--white);
      color: var(--brown); padding:0 20px; height:76px;
      display:flex; align-items:center; justify-content:space-between;
      position:sticky; top:0; z-index:100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    }
    .logo-wrap { display:flex; align-items:center; gap:12px; }
    .logo-icon { background: var(--cream); color: var(--primary); border-radius:50%; width:48px; height:48px; display:flex; align-items:center; justify-content:center; font-size:1.6rem; border: 2px solid #f1f5f9; }
    .logo-text strong { font-size:1.4rem; font-weight:900; color: var(--primary); display:block; letter-spacing: -0.5px; }
    .logo-text span   { font-size:.75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
    .cart-btn {
      background: var(--brown); color:#fff; border: none;
      border-radius:50px; padding:8px 20px; cursor:pointer;
      font-size:.95rem; font-weight:700; display:flex; align-items:center; gap:8px; transition:transform .2s, box-shadow .2s;
      box-shadow: 0 4px 12px rgba(15,23,42,0.15);
    }
    .cart-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(15,23,42,0.25); }
    .badge { background:var(--primary); color:#fff; border-radius:50%; width:24px; height:24px; font-size:.75rem; font-weight:800; display:flex; align-items:center; justify-content:center; }

    /* HERO */
    .hero {
      background: linear-gradient(150deg, var(--dark) 0%, var(--primary) 60%, #fda4af 100%);
      text-align:center; padding:54px 20px 62px; position:relative; overflow:hidden;
    }
    .hero::before { content:'ü•ö'; position:absolute; font-size:12rem; opacity:.05; top:-30px; left:-30px; transform:rotate(-20deg); }
    .hero::after  { content:'ü•ö'; position:absolute; font-size:12rem; opacity:.05; bottom:-30px; right:-30px; transform:rotate(20deg); }
    .hero h1 { font-size:clamp(2rem, 5vw, 3.2rem); font-weight:900; color:#fff; line-height:1.15; letter-spacing: -1px; }
    .hero h1 em { color:#ffe4e6; font-style:normal; }
    .hero p  { margin-top:14px; font-size:1.05rem; color:#ffe4e6; max-width:480px; margin-inline:auto; font-weight: 500; }
    .hero-badges { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:24px; }
    .hbadge { background:rgba(255,255,255,.15); border: 1px solid rgba(255,255,255,.3); border-radius:50px; padding:6px 16px; font-size:.85rem; font-weight:700; color:#fff; backdrop-filter: blur(4px); }

    /* CATALOG */
    main { padding:46px 20px 80px; max-width:1120px; margin:0 auto; }
    .section-title { font-size:1.4rem; font-weight:800; margin-bottom:28px; display:flex; align-items:center; gap:10px; color: var(--brown); }
    .section-title::after { content:''; flex:1; height:3px; background:linear-gradient(to right,var(--primary),transparent); border-radius:3px; opacity: 0.5; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:24px; }

    .card { background:var(--white); border-radius:24px; box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column; transition:transform .3s,box-shadow .3s; border:1px solid #e2e8f0; }
    .card:hover { transform:translateY(-8px); box-shadow:0 20px 40px rgba(15,23,42,.12); border-color: #cbd5e1; }
    .card-img { background:linear-gradient(135deg,#f1f5f9,#e2e8f0); display:flex; align-items:center; justify-content:center; height:140px; font-size:4.8rem; position:relative; overflow:hidden;}
    .pill { position:absolute; top:12px; right:12px; background:var(--dark); color:#fff; font-size:.7rem; font-weight:800; border-radius:50px; padding:4px 12px; text-transform:uppercase; letter-spacing: 0.5px; }
    .pill.green { background:var(--green); }
    .pill.amber { background:#f59e0b; }
    .pill.rose { background:var(--primary); }
    .card-body { padding:22px; flex:1; display:flex; flex-direction:column; gap:6px; }
    .card-body h3   { font-size:1.1rem; font-weight:800; color: var(--brown); }
    .card-body .sub { font-size:.75rem; color:var(--primary); font-weight:800; text-transform: uppercase; letter-spacing: 0.5px; }
    .card-body p    { font-size:.88rem; color:var(--muted); flex:1; margin-top:4px; line-height: 1.4; }
    .card-price { font-size:1.4rem; font-weight:900; color:var(--dark); margin-top:10px; letter-spacing: -0.5px; }
    .card-price small { font-size:.75rem; color:var(--muted); font-weight:600; letter-spacing: 0; }
    .qty-row { display:flex; align-items:center; gap:10px; margin-top:16px; }
    .qty-btn { width:36px; height:36px; border-radius:12px; border:2px solid #e2e8f0; background:transparent; color:var(--brown); font-size:1.1rem; font-weight:800; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .2s; }
    .qty-btn:hover { border-color:var(--primary); color:var(--primary); background: #fff1f2; }
    .qty-val { font-size:1rem; font-weight:800; min-width:24px; text-align:center; }
    .add-btn { flex:1; background:linear-gradient(135deg,var(--primary),var(--dark)); color:#fff; border:none; border-radius:12px; padding:10px 0; font-size:.9rem; font-weight:800; cursor:pointer; transition:opacity .2s,transform .15s; box-shadow: 0 4px 12px rgba(225,29,72,0.25); text-transform: uppercase; }
    .add-btn:hover { opacity:.9; transform:scale(1.02); }

    /* SIDEBAR / CARRINHO */
    .overlay { position:fixed; inset:0; background:rgba(15,23,42,.6); backdrop-filter: blur(2px); z-index:200; opacity:0; pointer-events:none; transition:opacity .3s; }
    .overlay.open { opacity:1; pointer-events:all; }
    .sidebar { position:fixed; top:0; right:-450px; bottom:0; width:min(450px,100vw); background:var(--cream); z-index:201; display:flex; flex-direction:column; transition:right .35s cubic-bezier(.4,0,.2,1); box-shadow:-8px 0 40px rgba(0,0,0,.15); }
    .sidebar.open { right:0; }
    .sb-header { padding:22px 24px; background:var(--white); color:var(--brown); display:flex; align-items:center; justify-content:space-between; border-bottom: 1px solid #e2e8f0; }
    .sb-header h3 { font-size:1.2rem; font-weight:900; }
    .close-x { background:#f1f5f9; border:none; color:var(--brown); width:36px; height:36px; border-radius:50%; font-size:1.1rem; font-weight: bold; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:background .2s; }
    .close-x:hover { background:#e2e8f0; }
    .cart-items { flex:1; overflow-y:auto; padding:18px; display:flex; flex-direction:column; gap:12px; }
    .empty { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; color:var(--muted); gap:12px; font-size:1rem; font-weight: 600; }
    .empty span { font-size:4rem; opacity: 0.5; }
    .ci { background:var(--white); border-radius:16px; padding:16px; display:flex; gap:16px; align-items:center; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid #f1f5f9; }
    .ci-emoji { font-size:2.4rem; width:64px; height:64px; background: #f8fafc; border-radius: 12px; display:flex; align-items:center; justify-content:center; overflow:hidden;}
    .ci-info { flex:1; display:flex; flex-direction:column; gap:4px; }
    .ci-info h4 { font-size:1rem; font-weight:900; color: var(--brown); margin:0; }
    .ci-price { font-size:1.1rem; font-weight:900; color:var(--dark); }
    .ci-rm { background:none; border:none; color:#ef4444; font-size:.75rem; font-weight:800; cursor:pointer; padding:6px 0; transition:color .2s; display:flex; align-items:center; justify-content:flex-end; gap:4px; text-transform:uppercase; letter-spacing:0.5px;}
    .ci-rm:hover { color:var(--dark); }
    .qty-controls { display:flex; align-items:center; gap:10px; margin-top:6px; }
    .qty-controls button { width:28px; height:28px; border-radius:8px; border:2px solid #e2e8f0; background:transparent; color:var(--brown); font-size:1.1rem; font-weight:900; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .2s; }
    .qty-controls button:hover { background:#fff1f2; border-color:var(--primary); color:var(--primary); }
    .qty-controls span { font-size:.95rem; font-weight:800; min-width:20px; text-align:center; }

    .sb-footer { padding:22px 24px; background: var(--white); border-top:1px solid #e2e8f0; box-shadow: 0 -4px 20px rgba(0,0,0,0.03); }
    .total-row { display:flex; justify-content:space-between; font-size:1.2rem; font-weight:900; margin-bottom:18px; color: var(--brown); }
    
    .checkout-btn { width:100%; background:linear-gradient(135deg,var(--primary),var(--dark)); color:#fff; border:none; border-radius:16px; padding:18px; font-size:1.05rem; font-weight:800; cursor:pointer; transition:transform .2s, box-shadow .2s; display:flex; align-items:center; justify-content:center; gap:10px; box-shadow: 0 8px 20px rgba(225,29,72,0.25); text-transform: uppercase; letter-spacing: 0.5px; }
    .checkout-btn:hover { transform:translateY(-2px); box-shadow: 0 10px 24px rgba(225,29,72,0.35); }
    .checkout-btn:disabled { opacity:.4; pointer-events:none; box-shadow: none; background: var(--muted); }

    /* MODAIS COMUNS */
    .mbk { position:fixed; inset:0; background:rgba(15,23,42,.7); backdrop-filter: blur(4px); z-index:300; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity .3s; }
    .mbk.open { opacity:1; pointer-events:all; }
    .modal { background:var(--white); border-radius:32px; width:min(480px,100%); max-height:92vh; overflow-y:auto; box-shadow:0 24px 64px rgba(0,0,0,.32); transform:scale(.95) translateY(20px); transition:all .3s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .mbk.open .modal { transform:scale(1) translateY(0); }
    
    /* MODAL CHECKOUT */
    .checkout-top { background:linear-gradient(135deg,var(--primary) 0%,var(--dark) 100%); padding:28px; border-radius:32px 32px 0 0; color:#fff; text-align:center; position: relative; }
    .checkout-top h3 { font-size:1.4rem; font-weight:900; margin-top:10px; }
    .checkout-top p  { font-size:.95rem; opacity:.9; margin-top:4px; font-weight: 500; }
    .modal-body { padding:28px; display:flex; flex-direction:column; align-items:center; gap:20px; }
    
    .delivery-toggle { display: flex; background: #f1f5f9; border-radius: 16px; padding: 6px; width: 100%; gap: 6px; }
    .dt-btn { flex: 1; padding: 14px; border: none; background: transparent; border-radius: 12px; font-size: .95rem; font-weight: 800; color: var(--muted); cursor: pointer; transition: all .2s; }
    .dt-btn.active { background: var(--white); color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    
    .checkout-section { width: 100%; }
    .info-box { background: #fff1f2; border: 2px dashed #fda4af; padding: 20px; border-radius: 16px; color: var(--dark); font-size: .95rem; line-height: 1.6; text-align: left; }
    
    .form-input { width: 100%; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: .95rem; color: var(--brown); font-family: inherit; transition: all .2s; background: #f8fafc; margin-bottom: 12px; }
    .form-input:focus { outline: none; border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(225,29,72,0.1); }
    .form-input.error { border-color: #ef4444; background: #fef2f2; }
    .form-row { display: flex; gap: 12px; }
    .w-1\/3 { width: 33.333%; }
    .w-2\/3 { width: 66.666%; }
    .form-label { display: block; text-align: left; font-size: .85rem; font-weight: 800; color: var(--brown); margin-bottom: 8px; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .confirm-btn { width:100%; background:var(--green); color:#fff; border:none; border-radius:16px; padding:18px; font-size:1.05rem; font-weight:800; cursor:pointer; transition:transform .2s; text-transform: uppercase; box-shadow: 0 8px 20px rgba(16,185,129,0.25); }
    .confirm-btn:hover { transform:scale(1.02); }
    
    .btn-ghost { background:transparent; border:none; color:var(--muted); cursor:pointer; font-weight:800; transition:color .2s; display:flex; align-items:center; gap:6px; }
    .btn-ghost:hover { color:var(--primary); }

    /* MODAL PIX */
    .modal-top.pix-top { background:linear-gradient(135deg,var(--green) 0%,#059669 100%); padding:28px; border-radius:32px 32px 0 0; color:#fff; text-align:center; }
    #qrcode-wrap { background:#fff; padding:16px; border-radius:24px; border:3px solid #f1f5f9; box-shadow: 0 8px 24px rgba(0,0,0,0.06); }
    .pix-rows { width:100%; background: var(--cream); border-radius: 16px; padding: 12px 20px; }
    .pr { display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #e2e8f0; font-size:.9rem; }
    .pr:last-child { border:none; }
    .pr label { color:var(--muted); font-weight: 600; }
    .pr span  { font-weight:800; color: var(--brown); text-align: right; }
    .copy-lbl { font-size:.8rem; color:var(--muted); align-self:flex-start; margin-bottom:-12px; font-weight: 700; }
    .copy-box { width:100%; background:#f1f5f9; border:2px dashed #cbd5e1; border-radius:16px; padding:14px; font-size:.8rem; font-family:monospace; color:var(--brown); font-weight: bold; word-break:break-all; cursor:pointer; transition:all .2s; user-select:all; text-align: center; }
    .copy-box:hover { background:#e2e8f0; border-color: var(--primary); color: var(--primary); }

    /* SUCCESS */
    .success { position:fixed; inset:0; background:var(--white); z-index:400; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:32px; opacity:0; pointer-events:none; transition:opacity .4s; }
    .success.open { opacity:1; pointer-events:all; }
    .success .icon { font-size:6rem; animation:pop 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) infinite; }
    @keyframes pop { 0%,100%{transform:scale(1)} 50%{transform:scale(1.15)} }
    .success h2 { font-size:2.4rem; font-weight:900; margin-top:16px; color: var(--brown); letter-spacing: -1px; }
    .success .sub-msg { color:var(--muted); margin-top:10px; max-width:380px; font-size:1.05rem; font-weight: 500; line-height: 1.5; }
    .order-box { margin-top:28px; background:linear-gradient(135deg,var(--primary),var(--dark)); color:#fff; border-radius:20px; padding:16px 40px; font-size:1.8rem; font-weight:900; letter-spacing:4px; box-shadow: 0 10px 25px rgba(225,29,72,0.3); }
    .order-lbl { font-size:.85rem; color:var(--muted); margin-top:12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .new-btn { margin-top:16px; background:var(--brown); color:#fff; border:none; border-radius:50px; padding:16px 36px; font-size:1rem; font-weight:800; cursor:pointer; transition:transform .2s; }
    .new-btn:hover { transform: translateY(-2px); }

    /* CONFETTI */
    .cf { position:fixed; width:10px; height:14px; border-radius:4px; top:-20px; animation:cffall linear forwards; z-index:500; pointer-events:none; }
    @keyframes cffall { to { transform:translateY(110vh) rotate(720deg); opacity:0; } }

    /* TOAST */
    .toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%) translateY(100px); background:var(--brown); color:#fff; padding:12px 28px; border-radius:50px; font-size:.95rem; font-weight:700; z-index:600; white-space:nowrap; transition:transform .4s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .toast.show { transform:translateX(-50%) translateY(0); }

    .no-products { text-align:center; padding:80px 20px; color:var(--muted); font-weight: 600; }
    .no-products span { font-size:4rem; display:block; margin-bottom:16px; opacity: 0.5; }
    
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: .5; transform: scale(0.9); } }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; display: inline-block; }

    footer { text-align:center; padding:24px; font-size:.85rem; font-weight: 600; color:var(--muted); border-top:1px solid #e2e8f0; margin-top: 20px; }

    @media (max-width:480px) { 
      header { padding:0 16px; } 
      main { padding:30px 16px 80px; } 
      .hero h1 { font-size: 2.2rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo-wrap">
    <div class="logo-icon" id="h-emoji">ü•ö</div>
    <div class="logo-text">
      <strong id="h-name">App Ovos Aline</strong>
      <span id="h-slogan">A carregar...</span>
    </div>
  </div>
  <button class="cart-btn" onclick="window.toggleCart()">üõí Carrinho <span class="badge" id="cart-count">0</span></button>
</header>

<div class="hero">
  <h1 id="hero-title">Ovos Fresquinhos ü•ö</h1>
  <p id="hero-desc">Qualidade de granja direto para a sua mesa.</p>
  <div class="hero-badges">
    <span class="hbadge">‚úÖ Padr√£o Ouro</span>
    <span class="hbadge">üöö Entrega R√°pida</span>
    <span class="hbadge">üíö Pague via PIX</span>
  </div>
</div>

<main>
  <h2 class="section-title">üõí Nosso Cat√°logo Especial</h2>
  <div class="grid" id="product-grid">
      <div class="no-products"><span class="animate-pulse">‚è≥</span>A ligar aos servidores da granja...</div>
  </div>
</main>

<footer id="footer-text">¬© 2026 App Ovos Aline ¬∑ Todos os direitos reservados</footer>

<div class="overlay" id="overlay" onclick="window.closeAll()"></div>

<div class="sidebar" id="sidebar">
  <div class="sb-header">
    <h3>üõí Seu Carrinho</h3>
    <button class="close-x" onclick="window.closeAll()">‚úï</button>
  </div>
  <div class="cart-items" id="cart-items">
    <div class="empty"><span>ü•ö</span>Seu carrinho est√° vazio</div>
  </div>
  <div class="sb-footer">
    <div class="total-row"><span>Total do Pedido</span><span id="cart-total">R$ 0,00</span></div>
    <button class="checkout-btn" id="checkout-btn" onclick="window.openCheckout()" disabled>üõçÔ∏è Avan√ßar para Checkout</button>
  </div>
</div>

<!-- MODAL CHECKOUT -->
<div class="mbk" id="checkout-modal">
  <div class="modal">
    <div class="checkout-top">
      <div style="font-size:2.8rem; line-height:1; margin-bottom: 8px;">üõçÔ∏è</div>
      <h3>Finalizar Pedido</h3>
      <p>Escolha como deseja receber a sua encomenda</p>
    </div>
    <div class="modal-body">
      
      <div class="delivery-toggle">
        <button class="dt-btn active" id="btn-retirada" onclick="window.setDelivery('retirada')">üè™ Retirar na Loja</button>
        <button class="dt-btn" id="btn-entrega" onclick="window.setDelivery('entrega')">üöö Entrega em Casa</button>
      </div>

      <div class="checkout-section" style="margin-top: 15px;">
        <label class="form-label" style="text-transform: none; margin-bottom: 4px;">Informa√ß√µes de Contato</label>
        <input type="text" id="cli-nome" placeholder="Seu Nome Completo" class="form-input" required>
        <input type="tel" id="cli-tel" placeholder="Telefone / WhatsApp" class="form-input" required>
      </div>

      <div id="info-retirada" class="checkout-section">
        <div class="info-box">
          <p>A <strong>Distribuidora de Ovos Aline</strong> est√° localizada na:</p>
          <p style="margin-top:8px;"><strong>Rua Ant√≥nio Freire da Silva, n¬∞ 87</strong><br>Jardim das Camelias<br>Zona Leste de S√£o Paulo - SP</p>
        </div>
      </div>

      <div id="info-entrega" class="checkout-section" style="display:none;">
        <label class="form-label" style="text-transform: none; margin-bottom: 4px;">Endere√ßo de Entrega</label>
        <div class="form-row">
          <input type="text" id="cli-cep" placeholder="CEP" class="form-input w-1/3">
          <input type="text" id="cli-rua" placeholder="Rua / Avenida" class="form-input w-2/3" required>
        </div>
        <div class="form-row">
          <input type="text" id="cli-num" placeholder="N√∫mero" class="form-input w-1/3" required>
          <input type="text" id="cli-bairro" placeholder="Bairro" class="form-input w-2/3" required>
        </div>
        <input type="text" id="cli-comp" placeholder="Complemento / Refer√™ncia" class="form-input">
      </div>

      <div class="checkout-section" style="margin-top: -10px;">
        <label class="form-label">Forma de Pagamento:</label>
        <select id="pagamento-select" class="form-input" style="font-weight: 700;"></select>
      </div>

      <div id="checkout-summary" style="width:100%; background:#f8fafc; padding:16px; border-radius:12px; margin-bottom:4px; font-size:1rem; color:var(--brown); font-weight:800; display:flex; flex-direction:column; gap:8px; border: 1px solid #e2e8f0;">
          <div style="display:flex; justify-content:space-between;"><span>Total do Pedido:</span><span id="chk-sub">R$ 0,00</span></div>
      </div>

      <div style="display: flex; flex-direction: column; gap: 12px; width: 100%; margin-top: 8px;">
          <button class="confirm-btn" onclick="window.processCheckout()">‚úÖ Confirmar Pedido (<span id="checkout-total-btn">R$ 0,00</span>)</button>
          <button class="btn-ghost" style="width: 100%; justify-content: center; padding: 12px; font-size: 0.95rem;" onclick="window.backToCart()">‚¨ÖÔ∏è Voltar para o Carrinho</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL PIX -->
<div class="mbk" id="pix-modal">
  <div class="modal">
    <div class="modal-top pix-top" style="background:linear-gradient(135deg,var(--green) 0%,#059669 100%); padding:28px; border-radius:32px 32px 0 0; color:#fff; text-align:center;">
      <div style="font-size:2.8rem; line-height:1; margin-bottom: 8px;">üíö</div>
      <h3 style="font-size:1.4rem; font-weight:900;">Pagamento via PIX</h3>
      <p style="font-size:.95rem; opacity:.9;">Escaneie o QR Code ou copie a chave</p>
    </div>
    <div class="modal-body" style="padding:28px; display:flex; flex-direction:column; align-items:center; gap:20px;">
      <div id="qrcode-wrap" style="background:#fff; padding:16px; border-radius:24px; border:3px solid #f1f5f9; box-shadow: 0 8px 24px rgba(0,0,0,0.06);"><div id="qrcode"></div></div>
      <div class="pix-rows" style="width:100%; background: var(--cream); border-radius: 16px; padding: 12px 20px;">
        <div class="pr" style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #e2e8f0; font-size:.9rem;"><label style="color:var(--muted); font-weight: 600;">Recebedor</label><span id="pix-nome" style="font-weight:800; color: var(--brown); text-align: right;">Loja</span></div>
        <div class="pr" style="display:flex; justify-content:space-between; padding:12px 0; font-size:.9rem;"><label style="color:var(--muted); font-weight: 600;">Valor Total</label><span id="pix-val" style="font-weight:800; color: var(--brown); text-align: right;">R$ 0,00</span></div>
      </div>
      <p class="copy-lbl" style="font-size:.8rem; color:var(--muted); align-self:flex-start; margin-bottom:-12px; font-weight: 700;">C√≥digo Copia e Cola (clique para copiar):</p>
      <div class="copy-box" id="pix-code" onclick="window.doCopy()" style="width:100%; background:#f1f5f9; border:2px dashed #cbd5e1; border-radius:16px; padding:14px; font-size:.8rem; font-family:monospace; color:var(--brown); font-weight: bold; word-break:break-all; cursor:pointer; transition:all .2s; user-select:all; text-align: center;"></div>
      
      <div style="display: flex; flex-direction: column; gap: 12px; width: 100%; margin-top: 10px;">
          <button class="confirm-btn" style="background:var(--brown); width:100%; color:#fff; border:none; border-radius:16px; padding:18px; font-size:1.05rem; font-weight:800; cursor:pointer; transition:transform .2s; text-transform: uppercase; box-shadow: 0 8px 20px rgba(15,23,42,0.25);" onclick="window.saveOrderToFirebase()">‚úÖ J√° Paguei ‚Äî Concluir</button>
          <button class="btn-ghost" style="width: 100%; justify-content: center; padding: 12px; font-size: 0.95rem;" onclick="window.backToCheckout()">‚¨ÖÔ∏è Alterar M√©todo de Pagamento</button>
      </div>
    </div>
  </div>
</div>

<!-- SUCCESS -->
<div class="success" id="success">
  <div class="icon">üéâ</div>
  <h2>Pedido Registrado!</h2>
  <p class="sub-msg">A sua encomenda foi gravada com sucesso! Alerte a loja enviando a confirma√ß√£o via WhatsApp.</p>
  <div class="order-box" id="order-num">#000000</div>
  
  <button class="checkout-btn" style="margin-top:32px; background:#10b981; box-shadow: 0 8px 20px rgba(16,185,129,0.25);" onclick="window.sendWhatsApp()">üì≤ Enviar Pedido para a Loja</button>
  <button class="new-btn" onclick="window.resetTudo()">üõí Fazer Novo Pedido</button>
</div>

<div class="toast" id="toast"></div>

<!-- L√ìGICA JAVASCRIPT & FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

// Configura√ß√£o Firebase
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
    apiKey: "AIzaSyD3Otz9-zdZH-E5Feg9IOGWPzVycoe8gro",
    authDomain: "distribuidora-de-ovos-aline.firebaseapp.com",
    projectId: "distribuidora-de-ovos-aline",
    storageBucket: "distribuidora-de-ovos-aline.firebasestorage.app",
    messagingSenderId: "92187548716",
    appId: "1:92187548716:web:d61d18a29aa76aead7c589"
};
const appId = typeof __app_id !== 'undefined' ? __app_id : 'app-egg-pro-transacional';

const appFB = initializeApp(firebaseConfig);
const auth = getAuth(appFB);
const db = getFirestore(appFB);

async function initAuth() {
    try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
    } catch (e) {
        console.error("Erro na autentica√ß√£o:", e);
    }
}
initAuth();

// Vari√°veis Globais Corrigidas
window.configuracoes_loja = {
  nome: 'App Ovos Aline',
  emoji: 'ü•ö',
  slogan: 'Qualidade Premium',
  heroTitle: 'Ovos <em>Fresquinhos</em> ü•ö',
  heroDesc: 'Qualidade de granja direto para a sua mesa.',
  corPrimaria: '#e11d48',
  corSecundaria: '#be123c',
  whatsapp: ''
};

window.pix_config = { copiaCola: '', nomeRecebedor: 'App Ovos Aline', rawKey: '', cidade: 'SAO PAULO' };

// Cat√°logo de Emerg√™ncia
const DEFAULT_PRODUTOS = [
    { id: 'def-1', nome: 'Ovos Brancos Pequenos', emoji: 'ü•ö', tipo: 'Tamanho P', embalagem: 'D√∫zia (12)', preco: 8.90, desc: 'Ovos brancos selecionados, tamanho pequeno.', badge: '', badgeClass: '', foto_url: '', ativo: true },
    { id: 'def-2', nome: 'Ovos Brancos M√©dios', emoji: 'ü•ö', tipo: 'Tamanho M', embalagem: 'Cartela (30)', preco: 21.90, desc: 'O favorito do dia a dia! Tamanho ideal para qualquer receita.', badge: '', badgeClass: '', foto_url: '', ativo: true },
    { id: 'def-3', nome: 'Ovos Brancos Grandes', emoji: 'ü•ö', tipo: 'Tamanho G', embalagem: 'D√∫zia (12)', preco: 12.90, desc: 'Ovos maiores com gema mais volumosa.', badge: 'Popular', badgeClass: 'rose', foto_url: '', ativo: true },
    { id: 'def-4', nome: 'Ovos Extra Grandes', emoji: 'ü•ö', tipo: 'Tamanho XG', embalagem: 'D√∫zia (12)', preco: 14.90, desc: 'Os maiores! Gema rica e intensa.', badge: 'Top Venda', badgeClass: 'rose', foto_url: '', ativo: true },
    { id: 'def-5', nome: 'Ovos Caipira', emoji: 'üêì', tipo: 'Caipira', embalagem: 'Meia D√∫zia (6)', preco: 9.90, desc: 'Cria√ß√£o livre no campo. Gema laranjinha e sabor incompar√°vel.', badge: 'Especial', badgeClass: 'amber', foto_url: '', ativo: true },
    { id: 'def-6', nome: 'Ovos Org√¢nicos', emoji: 'üåø', tipo: 'Org√¢nico', embalagem: 'Caixa com 120 ovos', preco: 95.90, desc: '100% org√¢nicos, sem antibi√≥ticos. Certificado. Ideal para revenda.', badge: 'Premium', badgeClass: 'green', foto_url: '', ativo: true }
];

window.produtos = [];
window.carrinho = {};
window.currentOrderContext = {}; 
window.catalogoCarregado = false; 

// Timeout de seguran√ßa
setTimeout(() => {
    if (!window.catalogoCarregado) {
        window.catalogoCarregado = true;
        window.renderProdutos();
    }
}, 2500);

window.generateUUID = () => {
    if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') return crypto.randomUUID();
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8); return v.toString(16);
    });
};

onAuthStateChanged(auth, (user) => {
    if (user) {
        // Escuta Estoque
        onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'estoque'), snap => {
            if (!snap.empty) {
                window.produtos = snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b)=>(a.nome||'').localeCompare(b.nome||''));
            } else {
                window.produtos = []; 
            }
            window.catalogoCarregado = true;
            window.renderProdutos();
            window.syncCarrinho(); 
        }, error => {
            console.error("Erro ao ler cat√°logo:", error);
            window.catalogoCarregado = true;
            window.renderProdutos();
        });

        // Escuta Config da Loja
        onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'store_config'), snap => {
            if (snap.exists()) {
                window.configuracoes_loja = { ...window.configuracoes_loja, ...snap.data() };
            }
            window.applyConfig(); 
        });

        // Escuta PIX
        onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'pix_config'), snap => {
            if (snap.exists()) {
                window.pix_config = { ...window.pix_config, ...snap.data() };
            }
        });
    }
});

window.applyConfig = () => {
  const c = window.configuracoes_loja;
  document.title = c.nome;
  document.getElementById('page-title').textContent  = c.nome;
  document.getElementById('h-name').textContent      = c.nome;
  document.getElementById('h-slogan').textContent    = c.slogan;
  document.getElementById('h-emoji').textContent     = c.emoji;
  if(c.heroTitle) document.getElementById('hero-title').innerHTML    = c.heroTitle;
  if(c.heroDesc) document.getElementById('hero-desc').textContent   = c.heroDesc;
  
  document.documentElement.style.setProperty('--primary', c.corPrimaria);
  document.documentElement.style.setProperty('--dark', c.corSecundaria);
};

window.toast = (msg) => {
    const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
};

window.fmt = n => Number(n).toFixed(2).replace('.',',');

window.renderProdutos = () => {
  const grid = document.getElementById('product-grid');
  
  if (!window.catalogoCarregado) {
      grid.innerHTML = '<div class="no-products"><span class="animate-pulse">‚è≥</span>A ligar aos servidores da granja...</div>'; 
      return; 
  }
  
  let ativos = window.produtos.filter(p => p.ativo !== false); 
  
  if (!ativos.length) { 
      ativos = DEFAULT_PRODUTOS;
      window.produtos = DEFAULT_PRODUTOS; 
  }
  
  grid.innerHTML = ativos.map(p => {
    const imageElement = (p.foto_url && p.foto_url.length > 5) 
            ? `<img src="${p.foto_url}" style="width:100%;height:100%;object-fit:cover;">` 
            : `<span>${p.emoji || 'ü•ö'}</span>`;

    return `
    <div class="card">
      <div class="card-img" style="font-size: ${p.foto_url ? '1rem' : '4.8rem'};">
        ${imageElement}
        ${p.badge ? `<div class="pill" style="background-color: var(--primary);">${p.badge}</div>` : ''}
      </div>
      <div class="card-body">
        <h3>${p.nome}</h3>
        <div class="sub">${p.tipo || ''}</div>
        <p>${p.desc || 'Ovos frescos de alta qualidade.'}</p>
        <div class="card-price">R$ ${window.fmt(p.preco)} <small>/ ${p.embalagem || 'Unidade'}</small></div>
        <div class="qty-row">
          <button class="qty-btn" onclick="window.chQty('${p.id}',-1)">‚àí</button>
          <span class="qty-val" id="qty-${p.id}">0</span>
          <button class="qty-btn" onclick="window.chQty('${p.id}',+1)">+</button>
          <button class="add-btn" onclick="window.addCart('${p.id}')">Adicionar</button>
        </div>
      </div>
    </div>`}).join('');
};

window.chQty = (id, d) => {
  const el = document.getElementById('qty-' + id);
  if (el) el.textContent = Math.max(0, parseInt(el.textContent) + d);
};

window.addCart = (id) => {
  const qty = parseInt(document.getElementById('qty-' + id)?.textContent || '0');
  if (!qty) { window.toast('Aten√ß√£o: Aumente a quantidade primeiro!'); return; }
  window.carrinho[id] = (window.carrinho[id] || 0) + qty;
  document.getElementById('qty-' + id).textContent = 0;
  window.syncCarrinho();
  window.toast('‚úÖ Produto adicionado ao carrinho!');
};

window.changeCartQty = (id, delta) => {
    if (!window.carrinho[id]) return;
    window.carrinho[id] += delta;
    if (window.carrinho[id] <= 0) {
        delete window.carrinho[id];
    }
    window.syncCarrinho();
};

window.syncCarrinho = () => {
  const total = Object.values(window.carrinho).reduce((s,v)=>s+v, 0);
  document.getElementById('cart-count').textContent = total;
  document.getElementById('checkout-btn').disabled = total === 0;
  window.renderCarrinho();
};

window.renderCarrinho = () => {
  const keys = Object.keys(window.carrinho).filter(k => window.carrinho[k] > 0);
  const el = document.getElementById('cart-items');
  if (!keys.length) {
    el.innerHTML = '<div class="empty"><span>ü•ö</span>Seu carrinho est√° vazio</div>';
    document.getElementById('cart-total').textContent = 'R$ 0,00';
    return;
  }
  let total = 0;
  el.innerHTML = keys.map(k => {
    const p = window.produtos.find(x => String(x.id) === String(k));
    if (!p) return '';
    const sub = p.preco * window.carrinho[k];
    total += sub;
    const imgHtml = (p.foto_url && p.foto_url.length > 5) ? `<img src="${p.foto_url}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;">` : (p.emoji || 'ü•ö');
    
    return `<div class="ci">
      <div class="ci-emoji" style="padding:${p.foto_url ? '0':'8px'}; border:${p.foto_url ? 'none':''};">${imgHtml}</div>
      <div class="ci-info">
        <h4>${p.nome}</h4>
        <p style="font-size:0.75rem; color:var(--muted);">${p.embalagem || 'Unidade'} ¬∑ R$ ${window.fmt(p.preco)}</p>
        <div class="qty-controls">
            <button onclick="window.changeCartQty('${k}', -1)">-</button>
            <span>${window.carrinho[k]}</span>
            <button onclick="window.changeCartQty('${k}', 1)">+</button>
        </div>
      </div>
      <div style="display:flex; flex-direction:column; align-items:flex-end; gap:8px;">
        <div class="ci-price">R$ ${window.fmt(sub)}</div>
        <button class="ci-rm" onclick="window.remCart('${k}')">üóë Remover</button>
      </div>
    </div>`;
  }).join('');
  document.getElementById('cart-total').textContent = 'R$ ' + window.fmt(total);
};

window.remCart = (id) => { delete window.carrinho[id]; window.syncCarrinho(); };

window.totalCarrinho = () => {
  return Object.keys(window.carrinho).reduce((s,k) => {
    const p = window.produtos.find(x => String(x.id) === String(k));
    return s + (p ? p.preco * window.carrinho[k] : 0);
  }, 0);
};

window.toggleCart = () => {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('overlay').classList.toggle('open');
};

window.closeAll = () => {
  ['sidebar','overlay','pix-modal','checkout-modal'].forEach(id => document.getElementById(id).classList.remove('open'));
};

window.backToCart = () => {
  document.getElementById('checkout-modal').classList.remove('open');
  document.getElementById('sidebar').classList.add('open');
};

window.backToCheckout = () => {
  document.getElementById('pix-modal').classList.remove('open');
  document.getElementById('checkout-modal').classList.add('open');
};

window.currentDeliveryType = 'retirada';

window.setDelivery = (type) => {
  window.currentDeliveryType = type;
  document.getElementById('btn-retirada').classList.toggle('active', type === 'retirada');
  document.getElementById('btn-entrega').classList.toggle('active', type === 'entrega');
  document.getElementById('info-retirada').style.display = type === 'retirada' ? 'block' : 'none';
  document.getElementById('info-entrega').style.display = type === 'entrega' ? 'block' : 'none';
  
  const tot = window.totalCarrinho();
  document.getElementById('checkout-total-btn').textContent = 'R$ ' + window.fmt(tot);
  document.getElementById('chk-sub').textContent = 'R$ ' + window.fmt(tot);

  document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
  window.updatePaymentOptions();
};

window.updatePaymentOptions = () => {
  const select = document.getElementById('pagamento-select');
  select.innerHTML = '';
  
  select.add(new Option('PIX Online (Pagar Agora)', 'pix_online'));

  if (window.currentDeliveryType === 'retirada') {
    select.add(new Option('PIX na Retirada', 'pix_retirada'));
    select.add(new Option('Cart√£o na Retirada', 'cartao_retirada'));
    select.add(new Option('Dinheiro na Retirada', 'dinheiro_retirada'));
  } else {
    select.add(new Option('PIX na Entrega', 'pix_entrega'));
    select.add(new Option('Cart√£o na Entrega', 'cartao_entrega'));
    select.add(new Option('Dinheiro na Entrega', 'dinheiro_entrega'));
  }
};

window.openCheckout = () => {
  window.setDelivery('retirada'); 
  document.getElementById('checkout-modal').classList.add('open');
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.add('open'); 
};

window.processCheckout = async () => {
  let clienteData = {};
  let temErro = false;
  
  document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
  
  const nomeEl = document.getElementById('cli-nome');
  const telEl = document.getElementById('cli-tel');

  if (!nomeEl.value.trim()) { nomeEl.classList.add('error'); temErro = true; }
  if (!telEl.value.trim()) { telEl.classList.add('error'); temErro = true; }

  if (window.currentDeliveryType === 'entrega') {
    const camposEntrega = ['cli-rua', 'cli-num', 'cli-bairro'];
    camposEntrega.forEach(id => {
      const el = document.getElementById(id);
      if (!el.value.trim()) { el.classList.add('error'); temErro = true; }
    });
  }

  if (temErro) {
    window.toast('Por favor, preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  clienteData = {
    nome: nomeEl.value.trim(),
    tel: telEl.value.trim(),
    rua: document.getElementById('cli-rua') ? document.getElementById('cli-rua').value.trim() : '',
    num: document.getElementById('cli-num') ? document.getElementById('cli-num').value.trim() : '',
    bairro: document.getElementById('cli-bairro') ? document.getElementById('cli-bairro').value.trim() : '',
    cep: document.getElementById('cli-cep') ? document.getElementById('cli-cep').value.trim() : '',
    comp: document.getElementById('cli-comp') ? document.getElementById('cli-comp').value.trim() : ''
  };

  const paymentMethod = document.getElementById('pagamento-select').value;
  
  window.currentOrderContext = {
    tipoEntrega: window.currentDeliveryType,
    clienteData,
    paymentMethod
  };

  document.getElementById('checkout-modal').classList.remove('open');

  if (paymentMethod === 'pix_online') {
    window.openPix();
  } else {
    await window.saveOrderToFirebase();
  }
};

window.removeAccents = (s) => (s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^\x00-\x7F]/g,'').toUpperCase();
window.pixPayload = (key, amount, name, city, txid) => {
    const tlv = (id, v) => id + String(v.length).padStart(2,'0') + v;
    const ma = tlv('00','BR.GOV.BCB.PIX') + tlv('01', key);
    let p = tlv('00','01') + tlv('26', ma) + tlv('52','0000') + tlv('53','986') + tlv('54', amount.toFixed(2)) + tlv('58','BR') + tlv('59', window.removeAccents(name).slice(0,25)||'LOJA') + tlv('60', window.removeAccents(city).slice(0,15)||'BR') + tlv('62', tlv('05', window.removeAccents(txid).slice(0,25)||'TESTE'));
    return p + tlv('63', window.crc16(p + '6304'));
};
window.crc16 = (s) => {
    let c = 0xFFFF;
    for (let i = 0; i < s.length; i++) {
        c ^= (s.charCodeAt(i) & 0xFF) << 8;
        for (let j = 0; j < 8; j++) c = (c & 0x8000) ? ((c << 1) ^ 0x1021) & 0xFFFF : (c << 1) & 0xFFFF;
    }
    return (c & 0xFFFF).toString(16).toUpperCase().padStart(4,'0');
};

window.openPix = () => {
  const total = window.totalCarrinho(); 
  
  let payloadCopiaCola = "";
  let chavePix = window.pix_config.rawKey || window.pix_config.key || '';
  
  if (chavePix) {
      const txid = ('OVOS' + Date.now().toString().slice(-7)).substring(0,25);
      payloadCopiaCola = window.pixPayload(chavePix, total, window.pix_config.nomeRecebedor, window.pix_config.cidade, txid);
  } else {
      payloadCopiaCola = window.pix_config.copiaCola || "Chave PIX n√£o configurada pelo Administrador.";
  }

  document.getElementById('pix-nome').textContent  = window.pix_config.nomeRecebedor || window.configuracoes_loja.nome;
  document.getElementById('pix-val').textContent   = 'R$ ' + window.fmt(total);
  document.getElementById('pix-code').textContent  = payloadCopiaCola;

  const qrDiv = document.getElementById('qrcode');
  qrDiv.innerHTML = '';
  setTimeout(()=>{
      try { new QRCode(qrDiv, { text:payloadCopiaCola, width:200, height:200, colorDark: window.configuracoes_loja.corSecundaria || '#be123c', colorLight:'#FFFFFF', correctLevel:QRCode.CorrectLevel.M }); } catch(e){}
  }, 50);

  document.getElementById('pix-modal').classList.add('open');
};

window.doCopy = () => {
  navigator.clipboard.writeText(document.getElementById('pix-code').textContent)
    .then(() => window.toast('üìã C√≥digo PIX copiado com sucesso!'))
    .catch(() => window.toast('Selecione o c√≥digo e copie manualmente'));
};

window.saveOrderToFirebase = async () => {
  document.getElementById('pix-modal').classList.remove('open');
  
  const orderNum = Math.floor(100000 + Math.random() * 900000);
  const pedidoHash = '#' + orderNum;
  
  document.getElementById('order-num').textContent = pedidoHash;
  window.currentOrderContext.hash = pedidoHash; 

  document.getElementById('success').classList.add('open');
  document.getElementById('overlay').classList.remove('open');
  window.confetti();

  const userId = auth.currentUser ? auth.currentUser.uid : window.generateUUID();

  try {
    const itens = Object.keys(window.carrinho).map(k => {
        const p = window.produtos.find(x => String(x.id) === String(k));
        return { id: p.id, nome: p.nome, qtd: window.carrinho[k], preco: p.preco };
    });
    
    const isPixOnline = window.currentOrderContext.paymentMethod === 'pix_online';
    
    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'vendas_logs'), {
        clienteId: userId,
        pedidoID: pedidoHash,
        valorTotal: window.totalCarrinho(),
        itens: itens,
        tipoEntrega: window.currentOrderContext.tipoEntrega,
        dadosCliente: window.currentOrderContext.clienteData || {},
        formaPagamento: window.currentOrderContext.paymentMethod,
        status: isPixOnline ? 'AGUARDANDO PIX' : 'CRIADO',
        criadoEm: serverTimestamp()
    });
  } catch (error) {
    console.error("Erro ao salvar pedido no Firebase:", error);
  }
};

window.sendWhatsApp = () => {
    if (!window.configuracoes_loja.whatsapp) {
        window.toast("Aviso: A loja ainda n√£o configurou um n√∫mero de WhatsApp.");
        return;
    }
    
    let texto = `*NOVO PEDIDO:* ${window.currentOrderContext.hash} ü•ö\n\n`;
    texto += `*Cliente:* ${window.currentOrderContext.clienteData.nome}\n`;
    texto += `*Telefone:* ${window.currentOrderContext.clienteData.tel}\n`;
    texto += `*M√©todo de Entrega:* ${window.currentOrderContext.tipoEntrega === 'entrega' ? 'üöö Entrega em Casa' : 'üè™ Retirar na Loja'}\n`;
    texto += `*M√©todo de Pagamento:* ${window.currentOrderContext.paymentMethod.replace('_', ' ').toUpperCase()}\n\n`;
    
    texto += `*ITENS SOLICITADOS:*\n`;
    Object.keys(window.carrinho).forEach(k => {
        const p = window.produtos.find(x => String(x.id) === String(k));
        if(p) texto += `‚Ä¢ ${window.carrinho[k]}x ${p.nome} (${p.embalagem || 'Unidade'}) : R$ ${window.fmt(p.preco * window.carrinho[k])}\n`;
    });
    
    texto += `\n*TOTAL A PAGAR: R$ ${window.fmt(window.totalCarrinho())}*\n\n`;
    
    if (window.currentOrderContext.tipoEntrega === 'entrega') {
        const d = window.currentOrderContext.clienteData;
        texto += `*Endere√ßo para Entrega:*\n${d.rua}, ${d.num} - ${d.bairro}\nCEP: ${d.cep} | Ref/Comp: ${d.comp}`;
    }
    
    const url = `https://wa.me/${window.configuracoes_loja.whatsapp}?text=${encodeURIComponent(texto)}`;
    window.open(url, '_blank');
};

window.resetTudo = () => {
  Object.keys(window.carrinho).forEach(k => delete window.carrinho[k]);
  window.currentOrderContext = {};
  window.syncCarrinho();
  
  document.getElementById('success').classList.remove('open');
  document.querySelectorAll('.form-input').forEach(el => {
    if(el.tagName === 'INPUT') el.value = '';
    el.classList.remove('error');
  });
  
  window.setDelivery('retirada');
  window.renderProdutos();
};

const COLS = ['#e11d48','#be123c','#10b981','#0f172a','#f59e0b','#3b82f6'];
window.confetti = () => {
  for(let i=0;i<100;i++) setTimeout(() => {
    const e = document.createElement('div'); e.className = 'cf';
    e.style.cssText = `left:${Math.random()*100}vw;background:${COLS[Math.random()*COLS.length|0]};animation-duration:${1.4+Math.random()*2}s;animation-delay:${Math.random()*.6}s;width:${6+Math.random()*8}px;height:${10+Math.random()*8}px;transform:rotate(${Math.random()*360}deg);`;
    document.body.appendChild(e); setTimeout(() => e.remove(), 4500);
  }, i*20);
};
</script>
</body>
</html>
