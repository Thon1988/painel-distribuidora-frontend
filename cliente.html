<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppEgg | Ovos Direto da Granja</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #fff; }
        .font-title { font-family: 'Montserrat', sans-serif; }
        .product-card { border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f3f4f6; }
        .btn-gradient { background: linear-gradient(90deg, #e11d48 0%, #fb7185 100%); }
        .tag { position: absolute; top: 15px; left: 15px; padding: 4px 10px; border-radius: 99px; font-size: 8px; font-weight: 900; text-transform: uppercase; }
        .tag-fitness { background: #dcfce7; color: #166534; }
        .tag-bolos { background: #fef9c3; color: #854d0e; }
    </style>
</head>
<body class="pb-24">
    <div id="app-root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD3Otz9-zdZH-E5Feg9IOGWPzVycoe8gro",
            authDomain: "distribuidora-de-ovos-aline.firebaseapp.com",
            projectId: "distribuidora-de-ovos-aline",
            storageBucket: "distribuidora-de-ovos-aline.firebasestorage.app",
            messagingSenderId: "92187548716",
            appId: "1:92187548716:web:d61d18a29aa76aead7c589"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const API_BASE = "https://painel-distribuidora-backend.onrender.com/api";

        window.state = { 
            produtos: [], 
            cliente: JSON.parse(localStorage.getItem('appegg_user')),
            checkoutItem: null,
            tipoCompra: 'unica',
            frequencia: 'semanal'
        };

        window.actions = {
            login: (e) => {
                e.preventDefault();
                const user = { nome: e.target.nome.value, whatsapp: e.target.whatsapp.value };
                localStorage.setItem('appegg_user', JSON.stringify(user));
                window.state.cliente = user;
                window.render();
            },
            finalizar: async (metodo) => {
                const p = window.state.checkoutItem;
                await addDoc(collection(db, "vendas_logs"), {
                    clienteNome: window.state.cliente.nome,
                    clienteWhatsapp: window.state.cliente.whatsapp,
                    produto: p.nome,
                    precoNoMomento: p.preco,
                    tipo: window.state.tipoCompra,
                    frequencia: window.state.tipoCompra === 'assinatura' ? window.state.frequencia : 'N/A',
                    pagamento: metodo,
                    status: 'PENDENTE',
                    criadoEm: serverTimestamp()
                });
                alert("üõí Pedido Enviado com Sucesso!");
                window.state.checkoutItem = null;
                window.render();
            }
        };

        window.render = () => {
            const root = document.getElementById('app-root');
            if(!window.state.cliente) {
                root.innerHTML = `
                    <div class="h-screen flex flex-col justify-center p-10">
                        <h1 class="font-title text-4xl text-rose-600 mb-8 italic text-center">AppEgg</h1>
                        <form onsubmit="window.actions.login(event)" class="space-y-4">
                            <input name="nome" placeholder="Seu Nome Completo" class="w-full p-4 border rounded-2xl font-bold" required>
                            <input name="whatsapp" placeholder="WhatsApp (Apenas n√∫meros)" class="w-full p-4 border rounded-2xl font-bold" required>
                            <button class="w-full py-4 btn-gradient text-white rounded-2xl font-black uppercase shadow-lg">Entrar</button>
                        </form>
                    </div>
                `;
                return;
            }

            root.innerHTML = `
                <header class="p-6 flex justify-between items-center">
                    <h1 class="font-title text-2xl text-rose-600 italic uppercase">AppEgg</h1>
                    <div class="bg-gray-100 p-2 rounded-full px-4 text-[10px] font-black uppercase">Ol√°, ${window.state.cliente.nome.split(' ')[0]}</div>
                </header>

                <div class="px-6 grid gap-8">
                    ${window.state.produtos.map(p => `
                        <div class="product-card flex flex-col relative overflow-hidden bg-white">
                            <div class="h-48 bg-gray-50 flex items-center justify-center p-6">
                                <img src="${p.foto_url}" class="max-h-full object-contain drop-shadow-xl">
                                <span class="tag ${p.nome.includes('Branco') ? 'tag-bolos' : 'tag-fitness'}">${p.nome.includes('Branco') ? 'Bolos & Massas' : 'Sa√∫de & Fitness'}</span>
                            </div>
                            <div class="p-5">
                                <h3 class="font-black text-gray-800 uppercase text-lg leading-tight mb-4">${p.nome}</h3>
                                <div class="flex justify-between items-end">
                                    <div><p class="text-[10px] text-gray-400 font-black">PRE√áO CAIXA</p><p class="text-2xl font-black text-rose-600">R$ ${p.preco.toFixed(2)}</p></div>
                                    <button onclick='window.state.checkoutItem=${JSON.stringify(p)}; window.render()' class="btn-gradient text-white px-6 py-3 rounded-2xl font-black text-[10px] uppercase shadow-lg shadow-rose-200">Comprar</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                ${window.state.checkoutItem ? `
                    <div class="fixed inset-0 bg-black/60 flex items-end z-50">
                        <div class="bg-white w-full rounded-t-[40px] p-8 animate-slide-up">
                            <h2 class="text-xl font-black text-center mb-6 uppercase">${window.state.checkoutItem.nome}</h2>
                            <div class="flex gap-2 mb-6 text-[10px] font-black">
                                <button onclick="window.state.tipoCompra='unica'; window.render()" class="flex-1 py-3 border-2 rounded-xl ${window.state.tipoCompra==='unica'?'border-rose-600 text-rose-600 bg-rose-50':'border-gray-100'}">COMPRA √öNICA</button>
                                <button onclick="window.state.tipoCompra='assinatura'; window.render()" class="flex-1 py-3 border-2 rounded-xl ${window.state.tipoCompra==='assinatura'?'border-rose-600 text-rose-600 bg-rose-50':'border-gray-100'}">CLUBE (PROGRAMAR)</button>
                            </div>
                            <div class="grid gap-2">
                                <button onclick="window.actions.finalizar('PIX')" class="w-full py-4 bg-black text-white rounded-2xl font-black uppercase text-xs">Pagar com PIX</button>
                                <button onclick="window.actions.finalizar('CART√ÉO')" class="w-full py-4 bg-gray-100 text-gray-800 rounded-2xl font-black uppercase text-xs">Cart√£o de Cr√©dito</button>
                                <button onclick="window.state.checkoutItem=null; window.render()" class="w-full py-2 text-gray-300 font-bold text-[10px] uppercase mt-2">Cancelar</button>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        };
        fetch(`${API_BASE}/produtos`).then(r => r.json()).then(d => { window.state.produtos = d; window.render(); });
    </script>
</body>
</html>