<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppEgg | Ovos Direto da Granja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .product-card { background: white; border-radius: 32px; border: 1px solid #f1f5f9; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .btn-main { background: #4f46e5; transition: all 0.3s ease; }
        .btn-main:active { transform: scale(0.95); }
    </style>
</head>
<body class="pb-10">
    <div id="app-root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD3Otz9-zdZH-E5Feg9IOGWPzVycoe8gro",
            authDomain: "distribuidora-de-ovos-aline.firebaseapp.com",
            projectId: "distribuidora-de-ovos-aline",
            storageBucket: "distribuidora-de-ovos-aline.firebasestorage.app",
            messagingSenderId: "92187548716",
            appId: "1:92187548716:web:d61d18a29aa76aead7c589"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const API_BASE = "https://painel-distribuidora-backend.onrender.com/api";

        window.state = { view: 'login', produtos: [], clienteData: JSON.parse(localStorage.getItem('appegg_user')) || null };

        window.actions = {
            login: (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                if (email === 'thon@lojista.com.br') {
                    const testador = { nome: "Admin Thon", email, doc: "000.000.000-00", whatsapp: "11999999999", rua: "Área de Teste", numero: "1", cidade: "São Paulo", estado: "SP" };
                    localStorage.setItem('appegg_user', JSON.stringify(testador));
                    window.state.clienteData = testador;
                } else if (!window.state.clienteData) return alert("Conta não encontrada. Cadastre-se!");
                window.state.view = 'loja';
                window.actions.loadProdutos();
            },
            salvarCadastro: (e) => {
                e.preventDefault();
                const f = new FormData(e.target);
                const data = { nome: f.get('nome'), email: f.get('email'), whatsapp: f.get('whatsapp'), doc: f.get('doc'), cep: f.get('cep'), rua: f.get('rua'), numero: f.get('numero'), cidade: f.get('cidade'), estado: f.get('estado') };
                localStorage.setItem('appegg_user', JSON.stringify(data));
                window.state.clienteData = data;
                window.state.view = 'loja';
                window.actions.loadProdutos();
            },
            loadProdutos: async () => {
                const res = await fetch(`${API_BASE}/produtos`);
                window.state.produtos = await res.json();
                window.render();
            }
        };

        window.render = () => {
            const root = document.getElementById('app-root');
            if (window.state.view === 'login' && !window.state.clienteData) {
                root.innerHTML = `<div class="p-8 h-screen flex flex-col justify-center max-w-md mx-auto">
                    <h1 class="text-4xl font-black text-indigo-600 mb-2 italic tracking-tighter text-center">AppEgg</h1>
                    <p class="text-slate-400 text-center mb-10 font-bold uppercase text-[10px] tracking-widest">Ovos frescos na palma da mão</p>
                    <form onsubmit="window.actions.login(event)" class="space-y-4">
                        <input name="email" type="email" placeholder="E-mail" required class="w-full p-5 rounded-3xl bg-white border border-slate-100 outline-none font-bold shadow-sm">
                        <button class="w-full py-5 btn-main text-white rounded-3xl font-black uppercase tracking-widest shadow-xl shadow-indigo-200">ENTRAR</button>
                        <button type="button" onclick="window.state.view='cadastro';window.render()" class="w-full py-3 text-slate-400 font-bold uppercase text-[10px] tracking-widest">Ainda não tenho conta</button>
                    </form>
                </div>`;
            } else if (window.state.view === 'cadastro') {
                root.innerHTML = `<div class="p-8 max-w-md mx-auto">
                    <h2 class="font-black text-2xl text-slate-800 mb-6">Criar Cadastro</h2>
                    <form onsubmit="window.actions.salvarCadastro(event)" class="space-y-4">
                        <input name="nome" placeholder="Nome / Razão Social" required class="w-full p-4 rounded-2xl border bg-white outline-none">
                        <input name="doc" placeholder="CPF ou CNPJ" required class="w-full p-4 rounded-2xl border bg-white outline-none">
                        <input name="whatsapp" placeholder="WhatsApp" required class="w-full p-4 rounded-2xl border bg-white outline-none">
                        <input name="email" type="email" placeholder="E-mail" required class="w-full p-4 rounded-2xl border bg-white outline-none">
                        <div class="grid grid-cols-2 gap-3">
                            <input name="rua" placeholder="Rua" required class="p-4 rounded-2xl border bg-white outline-none">
                            <input name="numero" placeholder="Nº" required class="p-4 rounded-2xl border bg-white outline-none">
                        </div>
                        <button class="w-full py-5 btn-main text-white rounded-3xl font-black uppercase">CADASTRAR E ENTRAR</button>
                    </form>
                </div>`;
            } else {
                root.innerHTML = `<header class="p-6 flex justify-between items-center bg-white border-b sticky top-0 z-50">
                    <h1 class="font-black text-indigo-600 italic text-xl">AppEgg</h1>
                    <button onclick="localStorage.clear(); location.reload()" class="text-[10px] text-slate-400 font-bold uppercase">Sair</button>
                </header>
                <div class="p-4 grid gap-4 max-w-xl mx-auto">
                    ${window.state.produtos.map(p => `
                        <div class="product-card p-6 flex justify-between items-center">
                            <div>
                                <h3 class="font-black text-slate-800 uppercase text-xs tracking-tight">${p.nome}</h3>
                                <p class="text-3xl font-black text-indigo-600">R$ ${p.preco.toFixed(2)}</p>
                                <span class="text-[9px] font-bold text-slate-400 uppercase">Preço por ${p.tipo_estoque}</span>
                            </div>
                            <button class="h-14 w-14 btn-main rounded-[24px] flex items-center justify-center text-white shadow-lg shadow-indigo-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4" /></svg>
                            </button>
                        </div>
                    `).join('')}
                </div>`;
            }
        };
        window.render();
    </script>
</body>
</html>